"use strict";var sn=Object.defineProperty;var i=(e,t)=>sn(e,"name",{value:t,configurable:!0});var I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Fe=I((Xs,De)=>{"use strict";De.exports={dropTable:"DROP TABLE IF EXISTS ${name};",createTable:"CREATE TABLE ${ifNotExistStatement}${name}${items}${options};",dropDatabase:"DROP DATABASE IF EXISTS ${name};",createCustomIndex:"CREATE CUSTOM INDEX ${ifNotExistStatement}${name}\n  ON ${tableName} (${column})\n  USING '${usingStatement}'${optionsStatement};",createIndex:"CREATE INDEX ${ifNotExistStatement}${nameStatement}\n  ON ${tableName} (${column});",createSearchIndex:"CREATE SEARCH INDEX ${ifNotExistStatement}ON ${tableName}\n  WITH COLUMNS\n${columnsStatement}${profiles}${config}${options};",dropType:"DROP TYPE IF EXISTS ${keyspaceName}.${typeName};",renameColumn:"${alterTablePrefixStatement} RENAME ${oldName} TO ${newName};",addEntity:"${alterTablePrefixStatement} ADD ${name} ${type};",deleteEntity:"${alterTablePrefixStatement} DROP ${name};",addPropertyToUdt:"${alterTypePrefixStatement}.${udtName} ADD ${name} ${type};",createUdt:"CREATE TYPE IF NOT EXISTS ${keySpaceName}.${udtName} (\n${columnScript} \n);",updateUdtType:"${alterTypePrefixStatement}.${udtName}\nALTER ${name} TYPE ${type};",renameType:"${alterTypePrefixStatement}.${udtName} \n	RENAME ${oldFieldName} TO ${newFieldName};",updateType:"${alterTablePrefixStatement} \n	ALTER ${name} TYPE ${type};",updateTableOptions:"${alterTablePrefixStatement}${optionsStatement};",dropSearchIndexConfig:"ALTER SEARCH INDEX CONFIG\n  ON ${tableNameStatement}\n    DROP ${indexName};",modifySearchIndex:"ALTER SEARCH INDEX CONFIG\n  ON ${tableNameStatement}\n    SET ${key} = ${value};",dropSearchIndex:"DROP SEARCH INDEX ON ${tableNameStatement};",dropIndex:"DROP INDEX IF EXISTS ${tableNameStatement};",dropKeySpace:"DROP KEYSPACE IF EXISTS ${keySpaceName};",createKeySpace:"CREATE KEYSPACE IF NOT EXISTS ${keySpaceName} \n${replication}\n${durableWrites}${udfScript}${udaScript};",alterKeySpaceReplication:"ALTER KEYSPACE ${keySpaceName} \n${replication}\n${durableWrites};",dropView:"DROP MATERIALIZED VIEW IF EXISTS ${viewName};",alterView:"ALTER MATERIALIZED VIEW ${keySpaceViewName}\n${optionScript};"}});var se=I((Qs,we)=>{"use strict";var Le=require("fs"),w=require("path"),ne=i(e=>{try{let t=Le.readFileSync(w.join(__dirname,"..",e));return JSON.parse(t.toString().replace(/\/\*[\s\S]*?\*\//g,""))}catch{return{}}},"getConfig"),re=i(e=>{let t;return(...n)=>(t||(t=e(...n)),t)},"cacheResult"),on=re(()=>ne(w.join("properties_pane","field_level","fieldLevelConfig.json"))),an=re(()=>ne(w.join("properties_pane","entity_level","entityLevelConfig.json"))),cn=re(()=>{let e=i(r=>r.replace(/\.json/,""),"getName"),t=w.join(__dirname,"..","types");return Le.readdirSync(t).reduce((r,s)=>(r[e(s)]=ne(w.join("types",s)),r),{})});we.exports={getEntityLevelConfig:an,getFieldLevelConfig:on,getTypesConfig:cn}});var v=I((eo,qe)=>{"use strict";var{getEntityLevelConfig:Js,getFieldLevelConfig:un,getTypesConfig:dn}=se(),ln=2,mn=i((e="")=>e.startsWith("DSE")&&(e.split(" ")[1]||"").split(".")[0]||"","getDataStaxVersion"),pn=i((e,t=1)=>{let n=" ".repeat(t*ln);return e.split(`
`).map(r=>n+r).join(`
`)},"tab"),R=i((e,t,n,r="")=>((e||[])[t]||{})[n]||r,"retrivePropertyFromConfig"),yn=i(e=>R(e,0,"code",R(e,0,"name","")),"retrieveContainerName"),fn=i(e=>R(e,0,"code",R(e,0,"collectionName","")),"retrieveEntityName"),Nn=i(e=>R(e,1,"UDFs",[]),"retrieveUDF"),gn=i(e=>R(e,2,"UDAs",[]),"retrieveUDA"),Sn=i((e,t)=>{let n=e[1],r={indexes:R(e,1,"SecIndxs",[])};return n.searchIndex&&(r.searchIndex={indexType:"search",columns:n.searchIndexColumns,config:n.searchIndexConfig,profiles:je(n.searchIndexProfiles,t),options:n.searchIndexOptions,ifNotExist:n.searchIndexIfNotExist}),r},"retrieveIndexes"),Ke=i((e,t)=>e.filter(n=>!t.includes(n)),"filterSpaceSaving"),je=i((e,t)=>{let n=mn(t),s=[(n.length?Number(n)>=6:!1)?"spaceSavingNoTextfield":""];return e=Array.isArray(e)?e:[e].filter(Boolean),e=Ke(e,s),Ke(["spaceSavingNoJoin","spaceSavingNoTextfield","spaceSavingSlowTriePrecision"],s).every(u=>e.includes(u))?["spaceSavingAll"]:e},"getIndexProfiles"),Tn=i((e,t)=>Ue(e,`"${t}"`),"getTableNameStatement"),Ue=i((e,t)=>`${e?`"${e}".`:""}${t}`,"getNameWithKeyspace"),En=i(e=>dn()[e],"getTypeConfig"),_e=i((e,t)=>{let n=un().structure;return n[e]?n[e].find(s=>s.propertyKeyword===t):void 0},"getFieldConfig"),oe=i((e,t)=>{let n=Object.assign({},e),r=i((o,a)=>Object.keys(o).reduce((u,c)=>{let l=o[c];return u[c]=a(oe(l,a),c),u},{}),"eachProperty"),s=i((o,a)=>o.map((u,c)=>a(oe(u,a),c)),"eachItem");if(n.hasOwnProperty("properties")&&(n.properties=r(n.properties,t)),n.hasOwnProperty("items")){let o=Array.isArray(n.items)?n.items:[n.items];n.items=s(o,t)}return n},"eachField"),In=i((e,t)=>{let n=_e(e,"mode")||{};return Array.isArray(n.options)?n.options.includes(t):!1},"canTypeHaveSubtype"),On=i((e,t=!0,n=!0,r=!0)=>{if(t||!n||!e)return e;let s=i((a,u="-- ")=>a.split(`
`).map(c=>`${u}${c}`).join(`
`),"insertBeforeEachLine");return r?i(a=>`/*
${s(a,"  ")}
*/`,"multiLineComment")(e):s(e)},"commentDeactivatedStatement"),hn=i(e=>{var n;let t=(n=e==null?void 0:e[0])==null?void 0:n.isActivated;return t===void 0?!0:t},"retrieveIsItemActivated"),An=i(e=>e.map(t=>t.functionBody).filter(t=>t).join(`
`),"getUserDefinedFunctions"),Cn=i(e=>e.map(t=>t.storedProcFunction).filter(t=>t).join(`
`),"getUserDefinedAggregations"),$n=i(e=>{let{applyDropStatements:t,additionalOptions:n=[]}=e.options||{},r=(n.find(s=>s.id==="applyDropStatements")||{}).value;return t||r},"getApplyDropStatement");qe.exports={tab:pn,retrieveContainerName:yn,retrieveEntityName:fn,retrieveUDF:Nn,retrieveUDA:gn,retrieveIndexes:Sn,retrivePropertyFromConfig:R,getTableNameStatement:Tn,getFieldConfig:_e,getTypeConfig:En,getNameWithKeyspace:Ue,eachField:oe,canTypeHaveSubtype:In,commentDeactivatedStatement:On,retrieveIsItemActivated:hn,getUserDefinedAggregations:Cn,getUserDefinedFunctions:An,getIndexProfiles:je,getApplyDropStatement:$n}});var K=I((no,ze)=>{"use strict";var Me="LINE",Ve="INLINE",ie="MULTILINE",Be=i((e,t="-- ")=>e.split(`
`).map(n=>n&&`${t}${n}`).join(`
`),"insertBeforeEachLine"),bn=i(e=>`/*
${Be(e,"  ")}
*/`,"multiLineComment"),We=i(e=>`/* ${e} */`,"inlineComment"),vn=i((e,t=!0,n=!0,r=ie)=>{if(t||!n||!e)return e;switch(r){case ie:return bn(e);case Ve:return We(e);case Me:return Be(e);default:return e}},"commentDeactivatedStatement");ze.exports={commentDeactivatedStatement:vn,inlineComment:We,LINE:Me,INLINE:Ve,MULTILINE:ie}});var G=I((so,Ge)=>{"use strict";var xn=["isActivated","type","compositePartitionKey"],He=i((e={},t=!1)=>t?e:xn.reduce((n,r)=>!e.hasOwnProperty(r)||e[r]===void 0?n:{...n,[r]:e[r]},{}),"getAttributes"),j=i((e,t,n)=>{if(e.GUID===t||e.id===t)return n;if(e.properties)return Object.keys(e.properties).reduce((r,s)=>{if(r)return r;{let o=e.properties[s];return j(o,t,[...n,o.GUID||o.id])}},void 0);if(e.items)return Array.isArray(e.items)?e.items.reduce((r,s)=>r||j(s,t,[...n,s.GUID||s.id]),void 0):j(e.items,t,[...n,e.items.GUID])},"getPathById"),Rn=i((e,t,n)=>{let r=Object.keys(t).find(o=>t[o].GUID===e||t[o].id===e),s=t[r];return s&&(s.code||s.name)?{name:s.code||s.name,...He(t[r],n)}:{name:r,...He(t[r],n)}},"getRootItemMetadataById"),kn=i((e,t,n)=>{let r=j(t,e,[]);return r?Rn(r[0],t.properties,n):{name:""}},"findFieldMetadataById"),Pn=i((e,t,n)=>e.reduce((r,s)=>{for(let o=0;o<t.length;o++){let a=kn(s,t[o],n);if(a!=null&&a.name)return Object.assign({},r,{[s]:a})}return r},{}),"getAttributesDataByIds");Ge.exports={getPathById:j,getNamesByIds:Pn}});var $=I((io,Ye)=>{"use strict";var ae={},Dn=i(e=>{ae.lodash=e.require("lodash"),ae.provider=Xe()(e)},"setDependencies");Ye.exports={setDependencies:Dn,dependencies:ae}});var tt=I((co,et)=>{"use strict";var{commentDeactivatedStatement:Fn,inlineComment:Ln}=K(),{tab:U,getTableNameStatement:wn}=v(),{getNamesByIds:Qe}=G(),{dependencies:ce}=$(),Kn=i((e,t,n,r,s,o,a)=>{let u=wn(r,n),c=s&&o,l=jn(u,t,e.indexes),m=a==="Astra DB"?[]:Un(u,t,c,e.searchIndex);return[...l,...m].map(N=>Fn(N.statement,N.isActivated,c)).join(`

`)},"getIndexes"),jn=i((e,t,n=[])=>Mn(n).map(r=>{let s,o=r.isActivated&&Je(r.SecIndxKey,t),a=Ze(r.SecIndxKey,t);return r.indexType==="custom"?s=ce.provider.createCustomIndex({name:r.name,tableName:e,column:a,using:r.isSASI?"org.apache.cassandra.index.sasi.SASIIndex":"StorageAttachedIndex",options:Bn(r.customOptions,r.isSASI),ifNotExist:r.indexIfNotExist}):s=ce.provider.createIndex({name:r.name,tableName:e,column:a,ifNotExist:r.indexIfNotExist}),{isActivated:o,statement:s}}),"getGeneralIndexes"),Un=i((e,t,n,r)=>{if(!r)return[];let s=[];r.columns&&(s=_n(r.columns.filter(c=>Array.isArray(c.key)&&c.key.length).map(c=>({...c,name:Ze(c.key[0],t),isActivated:Je(c.key[0],t)}))));let a=s.filter(c=>c.isActivated).length>0,u=Wn({tableName:e,isActivated:a&&n,index:r,columns:s,ifNotExist:r.ifNotExist});return[{isActivated:a,statement:u}]},"getSearchIndexStatement"),_n=i(e=>e.reduce((t,n)=>t.find(s=>s.name===n.name)?t:t.concat(n),[]),"uniqueByName"),Ze=i((e,t)=>{let{name:n}=Qe([e.keyId],t)[e.keyId]||{};return n?qn(`"${n}"`,e.type):""},"getIndexColumnStatement"),qn=i((e,t)=>t==="keys"?`KEYS(${e})`:t==="values"?`VALUES(${e})`:t==="entries"?`ENTRIES(${e})`:t==="full"?`FULL(${e})`:e,"wrapKey"),Je=i((e,t)=>{let{isActivated:n}=Qe([e.keyId],t)[e.keyId]||{};return n!==!1},"isIndexColumnKeyActivated"),Mn=i(e=>e.reduce((t,n)=>[...t,...(n.SecIndxKey||[]).map((r,s)=>Object.assign({},n,{name:s>0?n.name+"_"+s:n.name,SecIndxKey:r}))],[]),"unwindIndexes"),Vn=i(e=>Object.keys(e).map(t=>`'${t}': '${e[t]}'`),"serializeOptions"),Bn=i((e,t)=>{let n={};return!e||(e.case_sensitive&&(n.case_sensitive="true"),e.normalize&&(n.normalize="true"),e.ascii&&!t&&(n.ascii="true"),e.similarity_function&&!t&&(n.similarity_function=`${e.similarity_function}`),!t)||(e.analyzed&&(n.analyzed="true"),e.isLiteral&&(n.is_literal="true"),e.tokenizationEnableStemming&&(n.tokenization_enable_stemming="true"),e.tokenizationNormalizeLowercase&&(n.tokenization_normalize_lowercase="true"),e.tokenizationNormalizeUppercase&&(n.tokenization_normalize_uppercase="true"),e.normalizeLowercase&&(n.normalize_lowercase="true"),e.normalizeUppercase&&(n.normalize_uppercase="true"),e.tokenizationLocale&&(n.tokenization_locale=`${e.tokenizationLocale}`),e.tokenizationSkipStopWords&&(n.tokenization_skip_stop_words=`${e.tokenizationSkipStopWords}`),e.mode&&(n.mode=`${e.mode}`),e.analyzerClass&&(n.analyzer_class=`${e.analyzerClass}`),e.maxCompactionFlushMemoryInMb&&(n.max_compaction_flush_memory_in_mb=`${e.maxCompactionFlushMemoryInMb}`)),n},"getCustomOptions"),Wn=i(({tableName:e,columns:t,index:n,isActivated:r,ifNotExist:s})=>{let o=Hn(zn(t),r),a=n.profiles.length?`
${U(`AND PROFILES ${n.profiles.join(", ")}`)}`:"",u=Gn(n.config),c=u?`
${U(`AND CONFIG ${u}`)}`:"",l=Yn(n.options),m=l?`
${U(`AND OPTIONS ${l}`)}`:"";return ce.provider.createSearchIndex({ifNotExist:s,tableName:e,columnsStatement:U(o,2),profiles:a,config:c,options:m})},"getSearchIndex"),zn=i(e=>e.map(t=>{let n=[];return t.copyField&&n.push("copyField: true"),t.docValues&&n.push("docValues: true"),t.excluded&&n.push("excluded: true"),t.indexed||n.push("indexed: false"),t.lowerCase&&n.push("lowerCase: true"),{statement:`${t.name}${n.length?` {${n.join(", ")}}`:""}`,isActivated:t.isActivated}}),"getSearchIndexColumns"),Hn=i((e,t)=>{let n=t?e.filter(a=>!a.isActivated):[],r=t?e.filter(a=>a.isActivated):e,s=n.length?n.map(({statement:a})=>a).join(`,
`).split(`
`).map(Ln).join(`
`):"",o=r.map(({statement:a})=>a).join(`,
`);return s&&o?s+`,
`+o:s||o},"getSearchIndexColumnStatements"),Gn=i((e={})=>{let t=[];return e.autoCommitTime&&e.autoCommitTime!==1e4&&t.push(`autoCommitTime: ${e.autoCommitTime}`),e.defaultQueryField&&t.push(`defaultQueryField: '${e.defaultQueryField}'`),e.directoryFactory&&t.push(`directoryFactory: '${e.directoryFactory}'`),e.filterCacheLowWaterMark&&e.filterCacheLowWaterMark!==1024&&t.push(`filterCacheLowWaterMark: ${e.filterCacheLowWaterMark}`),e.filterCacheHighWaterMark&&e.filterCacheHighWaterMark!==2048&&t.push(`filterCacheHighWaterMark: ${e.filterCacheHighWaterMark}`),e.directoryFactoryClass&&t.push(`directoryFactoryClass: '${e.directoryFactoryClass}'`),e.mergeMaxThreadCount&&e.mergeMaxMergeCount&&(t.push(`mergeMaxThreadCount: ${e.mergeMaxThreadCount}`),t.push(`mergeMaxMergeCount: ${e.mergeMaxMergeCount}`)),e.ramBufferSize&&e.ramBufferSize!==512&&t.push(`ramBufferSize: ${e.ramBufferSize}`),e.realtime&&t.push("realtime: true"),t.length?`{
${U(t.join(`,
`))}
}`:""},"getSearchIndexConfig"),Yn=i((e={})=>{let t=[];return e.recovery&&t.push("recovery: true"),e.reindex||t.push("reindex: false"),e.lenient&&t.push("lenient: true"),t.length?`{${t.join(", ")}}`:""},"getSearchIndexOptions");et.exports={getIndexes:Kn,serializeOptions:Vn}});var Y=I((lo,ct)=>{"use strict";var{getFieldConfig:rt,getTypeConfig:nt,canTypeHaveSubtype:Xn}=v(),st=i(e=>{let t,n=i((r,s)=>{if(r===e)t=s;else if(r===void 0)return t;return n},"handler");return n},"ifType"),ue=i((e,t,n)=>{if(e){let r=rt(e,"mode"),s=r!=null&&r.options?r.options[0]:e;return me(e,n)({type:e,mode:s,frozen:!0,keyType:"char",keySubtype:"text",items:{type:"char",mode:"varchar"},properties:{field:{type:"char",mode:"varchar"}}})}return t},"getModeType"),ot=i((e,t)=>{let n=i(o=>o.type,"simpleType"),r=i(o=>`'${o.subType||"PointType"}'`,"geoSpatialType"),s=i(o=>{if(o.physicalType)return me(o.physicalType)(Object.assign(o,{type:o.physicalType}))},"getJsonType");return st(e)("char",o=>o.mode||"text")("numeric",o=>{let a=o.mode||"integer";return a==="integer"?"int":a})("binary",()=>"blob")("bool",()=>"boolean")("blob",n)("timestamp",n)("date",n)("time",n)("duration",n)("uuid",n)("timeuuid",n)("DseExecutorStateType",o=>`'${n(o)}'`)("DateRangeType",o=>`'${n(o)}'`)("geospatial",r)("udt",(o,a)=>de(a,t)())("jsonObject",s)("jsonArray",s)()},"getScalarType"),it=i((e,t,n)=>{let r=i(d=>!!d.frozen,"isFrozen"),s=i(d=>p=>{let E=d(p);return r(p)?le(E):E},"setFrozen"),o=i((d,p,E,S)=>{var f,h,F,x,z,Pe;if(d.items)if(Array.isArray(d.items)){let L=((f=d.items[0])==null?void 0:f.code)||((h=d.items[0])==null?void 0:h.name)||((F=d.items[0])==null?void 0:F.displayName);return u(d.items[0],r(d),L||0)}else{let L=((x=d.items)==null?void 0:x.code)||((z=d.items)==null?void 0:z.name)||((Pe=d.items)==null?void 0:Pe.displayName);return u(d.items,r(d),L||0)}else{let L=nt(d.type);if(L.subtypes&&d.subtype){let H=L.subtypes[d.subtype];if(H!=null&&H.childValueType)return ue(H.childValueType,p,E)}}return p},"getValueTypeFromArray"),a=i((d,p,E)=>{if(d.properties){let S=Object.keys(d.properties)[0];if(S){let f=d.properties[S];return u(f,r(d),S)}}else{let S=nt(d.type);if(S.subtypes&&d.subtype){let f=S.subtypes[d.subtype];if(f!=null&&f.childValueType)return ue(f.childValueType,p,E)}}return p},"getValueTypeFromObject"),u=((d,p)=>(E,S,f)=>{if(E){let h=Qn(E,!S&&d,p,f);if(h!==void 0)return h}else return"text"})(t,n),c=i((d,p)=>`set<${o(d,"varchar",n,p)}>`,"typeSet"),l=i((d,p)=>`list<${o(d,"text",n,p)}>`,"list"),m=i((d,p)=>`tuple<${(Array.isArray(d.items)?d.items:[d.items]).map((S,f)=>u(S,!0,f)).join(", ")}>`,"tuple"),y=i((d,p)=>{let E=Xn(d.keyType,d.keySubtype)?d.keySubtype:ue(d.keyType,"text",n),S=a(d,"text",n);return`map<${E}, ${S}>`},"map"),N=i((d,p)=>{let E=o(d,"float",n,p),S=Jn(d);return`vector<${E}, ${S}>`},"vector");return st(e)("map",s(y))("list",s(l))("set",s(c))("vector",s(N))("tuple",m)()},"getStructuralTypeHandler"),de=i((e,t,n)=>()=>{let r=t[e]||{};return r.frozen&&!n?le(r.name):r.name},"getUDTHandler"),le=i(e=>e===void 0?void 0:`frozen<${e}>`,"getFrozen"),me=i((e,t)=>ot(e,t)||it(e,!0,t)||de(e,t),"getHandlerByType"),Qn=i((e,t,n,r)=>{let s=at(e),o=ot(s,n);if(o)return o(e,r);let a=(it(s,!1,n)||de(s,n,t))(e,r);return t?le(a):a},"getNestedTypeByData"),at=i(e=>e.$ref?e.$ref.split("/definitions/").pop():e.type?e.type:"char","getTypeByPropertyData"),Zn=i((e,t,n)=>{let r=at(e);return me(r,t)(e,n)},"getTypeByData"),Jn=i(e=>{if(!isNaN(+e.dimension))return e.dimension;let t=rt(e.type,"dimension");return t==null?void 0:t.defaultValue},"getVectorDimension");ct.exports={getTypeByData:Zn}});var pe=I((po,ut)=>{"use strict";var{getTypeByData:er}=Y(),{commentDeactivatedStatement:tr}=v();ut.exports={getColumnDefinition(e,t={},n=!1){return Object.keys(e).map(r=>{let s=e[r],o=sr(s,t,r);if(o===void 0)return"";{let a=rr(s.code||r,o,nr(s));return tr(a,s.isActivated,n,!1)}}).filter(r=>r).join(`,
`)}};var nr=i(e=>!!(e||{}).static,"isStatic"),rr=i((e,t,n)=>`"${e}" ${t}${n?" STATIC":""}`,"getColumn"),sr=i((e,t,n)=>er(e,t,n),"getTypeDefinition")});var lt=I((fo,dt)=>{"use strict";var or=Object.freeze({ADD:"ADD",AGGREGATE:"AGGREGATE",ALLOW:"ALLOW",ALTER:"ALTER",AND:"AND",ANY:"ANY",APPLY:"APPLY",ASC:"ASC",AUTHORIZE:"AUTHORIZE",BATCH:"BATCH",BEGIN:"BEGIN",BY:"BY",COLUMNFAMILY:"COLUMNFAMILY",CREATE:"CREATE",DELETE:"DELETE",DESC:"DESC",DROP:"DROP",EACH_QUORUM:"EACH_QUORUM",ENTRIES:"ENTRIES",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",IF:"IF",IN:"IN",INDEX:"INDEX",INET:"INET",INFINITY:"INFINITY",INSERT:"INSERT",INTO:"INTO",KEYSPACE:"KEYSPACE",KEYSPACES:"KEYSPACES",LIMIT:"LIMIT",LOCAL_ONE:"LOCAL_ONE",LOCAL_QUORUM:"LOCAL_QUORUM",MATERIALIZED:"MATERIALIZED",MODIFY:"MODIFY",NAN:"NAN",NORECURSIVE:"NORECURSIVE",NOT:"NOT",OF:"OF",ON:"ON",ONE:"ONE",ORDER:"ORDER",PARTITION:"PARTITION",PASSWORD:"PASSWORD",PER:"PER",PRIMARY:"PRIMARY",QUORUM:"QUORUM",RENAME:"RENAME",REVOKE:"REVOKE",SCHEMA:"SCHEMA",SELECT:"SELECT",SET:"SET",TABLE:"TABLE",TIME:"TIME",THREE:"THREE",TO:"TO",TOKEN:"TOKEN",TRUNCATE:"TRUNCATE",TWO:"TWO",UNLOGGED:"UNLOGGED",UPDATE:"UPDATE",USE:"USE",USING:"USING",VIEW:"VIEW",WHERE:"WHERE",WITH:"WITH"}),ir=Object.values(or);dt.exports={ReservedWordsAsArray:ir}});var ye=I((No,pt)=>{"use strict";var{dependencies:mt}=$(),{ReservedWordsAsArray:ar}=lt(),cr=i((e,t)=>[...e,...t],"mergeArrays"),ur={blob:["ascii","bigint","boolean","decimal","double","float","inet","int","timestamp","timeuuid","uuid","varchar","varint"],varint:["int"],varchar:["text"],uuid:["timeuuid"],text:["varchar"]},dr=i(e=>{let t=e.filter(r=>r.dbVersion)[0].dbVersion,n=t.search(/\d/);if(n!==-1)return t[n]<3},"checkIsOldModel"),lr=i((e,t)=>{let n=ur[t];return!(!n||!n.filter(s=>s===e).length)},"fieldTypeCompatible"),mr=i(e=>/\s|\W/.test(e)||mt.lodash.includes(ar,mt.lodash.toUpper(e))?`"${e}"`:e,"wrapInQuotes");pt.exports={mergeArrays:cr,checkIsOldModel:dr,fieldTypeCompatible:lr,wrapInQuotes:mr}});var Ne=I((So,Et)=>{"use strict";var{inlineComment:yt}=K(),{dependencies:ft}=$(),pr="numeric",yr="text",fr="details",Nr="checkbox",gt="otherProperties",St="caching",gr=[St,gt],X=i(e=>e===""?`
WITH`:"  AND","getStringStart"),Tt=i(e=>String(e||"").replace(/[\"\`]/g,"'"),"changeQuotes"),Nt={localReadRepairChance:"dclocal_read_repair_chance",readRepairChance:"read_repair_chance",gcGraceSeconds:"gc_grace_seconds",bloomFilterFalsePositiveChance:"bloom_filter_fp_chance",defaultTtl:"default_time_to_live",speculativeRetry:"speculative_retry",minIndexInterval:"min_index_interval",maxIndexInterval:"max_index_interval",crcCheckChance:"crc_check_chance",memtableFlushPeriod:"memtable_flush_period_in_ms"},fe=i(e=>Nt.hasOwnProperty(e)?Nt[e]:e,"convertKeywordToTableOptionName"),Sr=i(e=>gr.includes(e.propertyKeyword)?Tr(e):Er(e),"transformOption"),Tr=i(e=>{switch(e.propertyKeyword){case St:return $r(e);case gt:return Ar(e);default:return null}},"transformSpecialOption"),Er=i(e=>{switch(e.propertyType){case yr:return Ir(e);case Nr:return Cr(e);case pr:return Or(e);case fr:return hr(e);default:return null}},"transformOptionByPropertyType"),Ir=i(e=>`${fe(e.propertyKeyword)} = '${e.value}'`,"transformTextOption"),Or=i(e=>`${fe(e.propertyKeyword)} = ${e.value}`,"transformNumericOption"),hr=i(e=>{let r=i(s=>typeof s=="object"?JSON.stringify(e.value):s,"getStringValue")(e.value).replace(/\n/g,"");return`${fe(e.propertyKeyword)} = ${Tt(r)}`},"transformDetailsOptions"),Ar=i(e=>e.value.reduce((n,r)=>{let{name:s,value:o}=r;if(!s||!o)return n;let a=n===""?"":"  AND";return n.concat(`${a} ${s} = '${o}'
`)},"").replace(/\n$/,""),"transformOtherOptions"),Cr=i(e=>{let t=e.propertyKeyword;return e.value?t==="cdc"?"cdc = TRUE":t==="compactStorage"?"COMPACT STORAGE":null:null},"transformBooleanOption"),$r=i(e=>{let t=i(c=>s.includes(c)?c:null,"validateKeys"),n=i(c=>s.includes(c)?c:isNaN(c)?null:Number(c),"validateRows"),r=i((c,l)=>Object.assign({},c&&{keys:c},l&&{rows_per_partition:l}),"createValueObject"),s=["ALL","NONE"],o=t(e.value.keys),a=n(e.value.rowsPerPartition);if(!o&&!a)return null;let u=JSON.stringify(r(o,a));return`caching = ${Tt(u)}`},"transformCachingOption"),br=i((e,t)=>{if(!t.value&&typeof t.value!="number")return e;let n=Sr(t);if(!n)return e;let r=X(e);return e.concat(`${r} ${n}
`)},"generateOptionsStringReducer"),vr=i((e,t)=>{if(t){let n=X(e);return e.concat(`${n} comment = '${t}'
`)}return e},"addCommentToOptionString"),xr=i((e,t)=>{if(!e)return t;let n=X(t);return t.concat(`${n} ID = '${e}'
`)},"addId"),Rr=i((e,t,n,r)=>{let s=e.filter(m=>t[m&&m.keyId]);if(!s.length)return n;let o=i(m=>m.map(y=>{let{keyId:N,type:d}=y,{name:p}=t[N];return`"${p}" ${d==="descending"?"DESC":"ASC"}`}),"mapKeys"),[a,u]=ft.lodash.partition(s,({keyId:m})=>ft.lodash.get(t,`${m}.isActivated`)!==!1);a=o(a),u=o(u);let c;r?u.length===0?c=a.join(", "):a.length===0?c=yt(u.join(", ")):c=`${a.join(", ")} ${yt(`, ${u.join(", ")}`)}`:c=o(s).join(", ");let l=X(n);return n.concat(`${l} CLUSTERING ORDER BY (${c})
`)},"addClustering");Et.exports={parseToString(e,t){let n=e.reduce(br,"");return vr(n,t)},addId:xr,addClustering:Rr}});var Q=I((Eo,vt)=>{"use strict";var{retrieveContainerName:kr,retrieveEntityName:Pr,retrivePropertyFromConfig:P,getTableNameStatement:Dr,commentDeactivatedStatement:Fr}=v(),{getColumnDefinition:Lr}=pe(),{getNamesByIds:It}=G(),{getEntityLevelConfig:wr}=se(),{parseToString:Kr,addId:jr,addClustering:Ur}=Ne(),{inlineComment:Ot}=K(),{dependencies:Ct}=$(),_r=i((e,t,n,r,s,o)=>{let a=[];return n&&a.push(n),r&&a.push(`PRIMARY KEY (${r})`),Ct.provider.createTable({ifNotExist:o,databaseName:Dr(e,t),items:a,options:s})},"getCreateTableStatement"),ht=i((e,t,n)=>{let r=qr(e,n),s=Mr(t,n),o=[];return r&&o.push(r),s&&o.push(s),o.join(s.startsWith("/*")||r.endsWith("*/")?" ":", ")},"getPrimaryKeyList"),qr=i((e,t)=>{let n=Object.keys(e);if(n.length){let r=bt(n,e,t);return n.length>1?`(${r})`:r}else return""},"getPartitionKeys"),Mr=i((e,t)=>{let n=Object.keys(e);return n.length?bt(n,e,t):""},"getClusteringKeys"),Vr=i((e,t)=>e.map(n=>{let r=t[n.propertyKeyword];return r===void 0?n:Object.assign({},n,{value:r})}),"seedOptionsWithValues"),Br=i(e=>e.structure.find(n=>n.propertyName==="Options").structure,"getOptionsFromTab"),$t=i(e=>{let[t]=wr(),n=Br(t);return Vr(n,e)},"mergeValuesWithConfigOptions"),At=i((e,t,n,r,s,o)=>{let a=$t(r),u=jr(n,Ur(e,t,Kr(a,s),o));return u?u.replace(/\n$/,""):""},"getOptions"),bt=i((e,t,n)=>{let r=i(a=>a.map(u=>t[u].name).join('", "'),"joinKeys");if(!n)return`"${r(e)}"`;let[s,o]=Ct.lodash.partition(e,a=>t[a].isActivated!==!1);return o.length===0?`"${r(s)}"`:s.length===0?`${Ot(`"${r(o)}"`)}`:`"${r(s)}" ${Ot(`, "${r(o)}"`)}`},"commentDeactivatedKeys");vt.exports={getOptions:At,getPrimaryKeyList:ht,getTableStatement({tableData:e,tableMetaData:t,dataSources:n,keyspaceMetaData:r,udtTypeMap:s,isKeyspaceActivated:o}){let a=kr(r),u=Pr(t),c=P(t,0,"compositePartitionKey",[]),l=P(t,0,"compositeClusteringKey",[]),m=P(t,0,"schemaId",""),y=P(t,0,"comments",""),N=P(t,0,"tableOptions",""),d=P(t,0,"isActivated",!1),p=o&&d,E=It(c.map(h=>h.keyId),n),S=It(l.map(h=>h.keyId),n),f=_r(a,u,Lr(e.properties||{},s,p),ht(E,S,p),At(l,S,m,N,y,p),P(t,0,"tableIfNotExist",void 0));return Fr(f,d,o)},mergeValuesWithConfigOptions:$t}});var Z=I((Oo,xt)=>{"use strict";var Te=class Te{script;isDropScript;isModifyScript;isAddScript};i(Te,"ModificationScript");var ge=Te,Ee=class Ee{isActivated;scripts;static getInstances(t,n,r,s){return(t||[]).filter(Boolean).map(o=>this.getInstance([o],n,r,s))}static getInstance(t,n,r,s){var a;if(!((a=t==null?void 0:t.filter(Boolean))!=null&&a.length))return;let o={deletion:!1,add:!1,modify:!1};if(o[r]===void 0)throw new Error(`Unsupported scriptPurpose provided: ${r}`);return o[r]=!0,{isActivated:n,scripts:t.filter(Boolean).map(u=>({isDropScript:o.deletion,script:u,isModifyScript:o.modify,isAddScript:o.add,modelLevel:s}))}}};i(Ee,"AlterScriptDto");var Se=Ee;xt.exports={ModificationScript:ge,AlterScriptDto:Se}});var Kt=I((Ao,wt)=>{"use strict";var{getTypeByData:Rt}=Y(),{getNamesByIds:Ie}=G(),{dependencies:A}=$(),{eachField:Wr,getTableNameStatement:Ft}=v(),{getTableStatement:zr}=Q(),{AlterScriptDto:J}=Z(),k={modifiedColumn:[],addTable:[],deleteTable:[]},Hr=i(e=>ee(e)?[]:[J.getInstance([A.provider.addEntity(e)],!0,"add","field")],"getAdd"),Gr=i(e=>ee(e)?[]:[J.getInstance([A.provider.deleteEntity(e)],!0,"deletion","field")],"getDelete"),Lt=i(e=>{let{tableName:t,keyspaceName:n,columnData:r}=e,s=Ft(n,t);return r!=null&&r.name?`${s}.${r==null?void 0:r.name}`:s},"generateFullName"),he=i((e={},t="modifiedColumn")=>{let n=Lt(e);k={...k,[t]:[...(k==null?void 0:k[t])||[],n]}},"addScriptToExistScripts"),ee=i((e={},t="modifiedColumn")=>{let n=Lt(e);return((k==null?void 0:k[t])||[]).some(r=>r===n)},"isScriptExists"),Yr=i((e,t)=>{let n=i(s=>!s.hasOwnProperty("properties")||!Array.isArray(s.properties)?s:{...s,properties:s.properties.reduce((o,a)=>({...o,[a.name]:n(a)}),{})},"propertiesFromArrayToObj"),r=n(e);return Wr(r,s=>{if((s==null?void 0:s.type)!=="reference"||A.lodash.isEmpty(s.refIdPath))return s;let o=Ie([A.lodash.last(s.refIdPath)],t)[A.lodash.last(s.refIdPath)]||{};return{...s,...o}})},"prepareField"),Xr=i(({tableName:e,keyspaceName:t,isOldModel:n,property:r,udtMap:s,dataSources:o})=>{let{oldField:a={},newField:u={}}=(r==null?void 0:r.compMod)||{},c=Yr(a,o),l=Rt(r,s,u.name),m=Rt(c,s,a.name);return{property:r,isOldModel:n,oldName:a.name,newName:u.name,newType:l,oldType:m,isNameChange:a.name!==u.name,isTypeChange:l!==m,dataForScript:{tableName:e,keyspaceName:t,columnData:{name:u.name,type:l}}}},"hydrateColumn"),Oe=i((e,t)=>{var r,s,o;let n=(s=(r=e==null?void 0:e.role)==null?void 0:r.compMod)==null?void 0:s[t];return(n==null?void 0:n.new)||((o=e==null?void 0:e.role)==null?void 0:o[t])},"getTableParameter"),kt=i((e,t)=>Object.entries(e).reduce((n,[r,s])=>{let o=(t.find(a=>a.keyId===r)||{}).type;return{...n,[r]:{...A.lodash.omit(s,"type"),...o?{type:o}:{}}}},{}),"addToKeysHashType"),Pt=i((e,t)=>A.lodash.omitBy(e,(n,r)=>n===!1&&!t[r]),"deleteFalseValuesIfNotPresentInOtherColumn"),Qr=i((e,t)=>{let n=Pt(e,t),r=Pt(t,e);return A.lodash.isEqual(n,r)},"areTableKeyColumnsEqual"),Dt=i(({newKeys:e=[],oldKeys:t=[],dataSources:n})=>{if(e.length!==t.length)return!1;let r=kt(Ie(e.map(a=>a.keyId),n),e),s=kt(Ie(t.map(a=>a.keyId),n),t),o=A.lodash.differenceWith(A.lodash.values(r),A.lodash.values(s),Qr);return A.lodash.isEmpty(o)},"tableKeysIsEqual"),Zr=i(({item:e,dataSources:t})=>{var c;let n=((c=e==null?void 0:e.role)==null?void 0:c.compMod)||{},r=["name","isActivated"],{compositeClusteringKey:s={},compositePartitionKey:o={}}=n||{},a=Dt({newKeys:s.new,oldKeys:s.old,dataSources:t}),u=Dt({newKeys:o.new,oldKeys:o.old,dataSources:t});return!a||!u||r.some(l=>{var m,y;return!A.lodash.isEqual((m=n[l])==null?void 0:m.new,(y=n[l])==null?void 0:y.old)})},"isTableChange"),Jr=i(e=>{if(ee(e,"deleteTable"))return[];let t=Ft(e.keyspaceName,e.tableName);return he(e,"deleteTable"),[J.getInstance([A.provider.dropTable(t)],!0,"deletion","table")]},"getDeleteTableDto"),es=i(e=>{if(ee(e,"addTable"))return[];let t=e.item,n=e.data,r=Oe(t,"compositePartitionKey")||[],s=Oe(t,"compositeClusteringKey")||[],o=[{compositePartitionKey:r,compositeClusteringKey:s,collectionName:e.tableName,tableOptions:t.role.tableOptions||"",comments:t.role.comments||"",isActivated:t.role.isActivated}],a=zr({tableData:t,tableMetaData:o,keyspaceMetaData:[{name:e.keyspaceName}],dataSources:e.dataSources,udtTypeMap:n.udtTypeMap||{},isKeyspaceActivated:e.isKeyspaceActivated});return he(e,"addTable"),[J.getInstance([a],!0,"add","table")]},"getAddTable");wt.exports={getDelete:Gr,getAdd:Hr,hydrateColumn:Xr,isTableChange:Zr,getTableParameter:Oe,addScriptToExistScripts:he,getDeleteTableDto:Jr,getAddTable:es}});var _t=I(($o,Ut)=>{"use strict";var{dependencies:C}=$(),{getColumnDefinition:ts}=pe(),{eachField:ns}=v(),{getTypeByData:Ae}=Y(),{checkIsOldModel:rs,fieldTypeCompatible:ss}=ye(),{getDelete:os}=Kt(),{AlterScriptDto:_}=Z(),is={Default_Keyspace:[]},as={added:!1,deleted:!1,modified:!1,udt:"udt"},cs=i(e=>`ALTER TYPE "${e}"`,"getAlterTypePrefix"),us=i(e=>[_.getInstance([C.provider.dropType({keyspaceName:e.keyspaceName,typeName:e.typeName})],!0,"deletion","udt")],"getDropUDT"),ds=i(e=>{let{keySpaces:t,udtName:n,name:r,type:s}=e;return Object.keys(t).map(o=>_.getInstance([C.provider.addPropertyToUdt({keySpaceName:o,udtName:n,name:r,type:s})],!0,"add","udt"))},"getAddToUDT"),Ce=i(e=>{var n;let t=(n=e.compMod)==null?void 0:n.bucketsWithCurrentDefinition;return C.lodash.isEmpty(t)?is:t},"getKeySpaces"),ls=i((e,t)=>{let{role:n={},compMod:r={},properties:s={}}=e,o=Ce(n);if(r.created){let a=ts(s,t);return Object.keys(o).map(u=>{let c=n.code||n.name||"";return _.getInstance([C.provider.createUdt({keySpaceName:u,udtName:c,columnScript:a})],!0,"add","udt")})}return Object.entries(s).reduce((a,[u,c])=>[...a,...ds({type:Ae(c,t),name:u,keySpaces:o,udtName:n.code||n.name||""})],[])},"getAddScript"),jt=i((e,t)=>e.type!=="reference"||e.$ref||!t.$ref?e:{...e,$ref:t.$ref},"prepareField"),ms=i((e,t,n)=>{let{role:r={},properties:s}=e;if(!s)return[];let o=Ce(r),a=r.code||r.name;return Object.entries(s).reduce((u,[c,l])=>{let m=C.lodash.get(l,"compMod.oldField.name"),y=C.lodash.get(l,"compMod.newField.name"),{compMod:N={}}=l,d=Ae(jt(N.oldField,l),n,"newField"),p=Ae(jt(N.newField,l),n,"oldField"),E=rs(C.lodash.get(t,"modelData")),S=Object.keys(o).reduce((f,h)=>{if(p&&d&&p!==d&&ss(d,p)&&E){let x=C.provider.updateUdtType({keySpaceName:h,udtName:a,columnData:{name:c,type:p}});f=[...f,_.getInstance([x],!0,"modify","udt")]}if(y&&m&&m!==y){let x=C.provider.renameType({keySpaceName:h,oldFieldName:m,newFieldName:y,udtName:a});f=[...f,_.getInstance([x],!0,"modify","udt")]}return f},[]);return[...u,...S]},[])},"getUpdateScript"),ps=i(e=>{let{properties:t,compMod:n={},role:r={}}=e;if(!(n!=null&&n.deleted)||!t)return[as];let s=Ce(r),o=r.code||r.name||"";return Object.entries(s).reduce((a,[u,c])=>{let l=c.reduce((m,y)=>{let N=os({tableName:y.collectionName||y.code,keyspaceName:u,columnData:{name:o}}),d=us({keyspaceName:u,typeName:o});return[...m,...N,...d]},[]);return[...a,...l]},[])},"getDeleteScript"),ys=i(({child:e,mode:t,data:n,udtMap:r})=>t==="add"?ls(e,r):t==="update"?ms(e,n,r):ps(e),"getUdtScript"),fs=i(e=>{var u;let t=(u=e.properties.added)==null?void 0:u.items;if(!t||!Array.isArray(t))return e;let n=t.filter(c=>{var m;return(m=c.properties[Object.keys(c.properties)[0]].compMod)==null?void 0:m.created}),r=C.lodash.xorWith(t,n,C.lodash.isEqual);n=n.map(c=>[Object.keys(c.properties)[0],c]);let s=n.map(([c,l])=>c),o=[];n.forEach(([c,l])=>{let m=new Set,y=l.properties[c];ns(y||{},d=>{if(d.$ref){let p=d.$ref.split("/").pop();m.add(p)}});let N=Array.from(m).filter(d=>s.includes(d)&&!o.includes(d));if(o.push(...N),!N.length){let d=o.indexOf(c);d===-1?o.unshift(c):o.unshift(...o.splice(d,1))}});let a=s.filter(c=>!o.includes(c));return n=Object.fromEntries(n),n=[...o,...a].map(c=>n[c]).filter(Boolean),e.properties.added.items=[...n,...r],e},"sortAddedUdt");Ut.exports={getUdtScript:ys,sortAddedUdt:fs,getAlterTypePrefix:cs}});var Vt=I((vo,Mt)=>{"use strict";var{dependencies:D}=$(),Ns="caching",gs="compaction",Ss="compression",Ts="id",Es=[Ts],q={localReadRepairChance:0,caching:{keys:"ALL",rows_per_partition:"NONE"},compaction:"{'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy', 'max_threshold': '32', 'min_threshold': '4'}",compression:"{'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}",readRepairChance:0,gcGraceSeconds:864e3,bloomFilterFalsePositiveChance:.01,defaultTtl:0,speculativeRetry:"99PERCENTILE",minIndexInterval:128,maxIndexInterval:2048,crcCheckChance:1,memtableFlushPeriod:0},qt=i((e,t,n)=>{switch(n){case Ss:case gs:return Is(e,t);case Ns:return Os(e,t);default:return e!==t}},"isDiff"),Is=i((e,t)=>{if(e===""||t==="")return e!==t;let n=JSON.parse(e.replace(/[\'']/g,'"')),r=JSON.parse(t.replace(/[\'']/g,'"'));return!D.lodash.isEqual(n,r)},"isDiffParsedJsonString"),Os=i((e,t)=>{let n=i(o=>{let a=D.lodash.get(o,"rowsPerPartition");return a?{...D.lodash.omit(o,"rowsPerPartition"),rows_per_partition:a}:o},"updateKeys"),r=Object.assign({},n(e),{id:null}),s=Object.assign({},n(t),{id:null});return!D.lodash.isEqual(r,s)},"isDiffCaching"),hs=i((e,t)=>(t=D.lodash.isEmpty(t)?q:t,Object.entries(e).reduce((n,[r,s])=>Es.includes(r)?n:!t.hasOwnProperty(r)||qt(t[r],s,r)?Object.assign({},n,{[r]:s}):n,{})),"getModifiedAndNewOptions"),As=i((e,t)=>(e=D.lodash.isEmpty(e)?q:e,Object.keys(t).filter(n=>!e.hasOwnProperty(n))),"getDeletedOptions"),Cs=i((e,t)=>e.reduce((n,r)=>q.hasOwnProperty(r)&&qt(D.lodash.get(t,r),q[r],r)?Object.assign({},n,{[r]:q[r]}):n,{}),"getDefaultOptionsByName");Mt.exports={getDiff(e,t){let n=hs(e,t),r=As(e,t);return Object.assign({},n,Cs(r,t))}}});var Re=I((Ro,Xt)=>{"use strict";var{dependencies:O}=$(),{commentDeactivatedStatement:ve}=K(),{retrieveContainerName:$s,retrieveEntityName:bs,retrivePropertyFromConfig:M,retrieveIsItemActivated:Bt}=v(),{getOptions:vs,getPrimaryKeyList:xs}=Q(),Wt=i(e=>e.name,"columnsToName"),Rs=i((e=[],t)=>{let[n,r]=O.lodash.partition(e,o=>O.lodash.get(o,"isActivated",!0));r=r.map(Wt).join(", "),n=n.map(Wt).join(", ");let s=i(o=>ve(o,!1,t,"INLINE"),"getDeactivatedStatement");if(r.length){if(!n.length)return s(r)}else return n;return n+" "+s(", "+r)},"joinColumns"),ks=i((e,t,n={})=>{let r=e[t];return Object.values(n).find(s=>s.GUID===(r==null?void 0:r.definitionId))||{}},"getColumn"),Ps=i((e,t)=>O.lodash.uniqBy(Object.keys(t).map(n=>{let r=O.lodash.get(t,[n,"GUID"]),s=Object.keys(e).find(c=>e[c].definitionId===r),o=e[s],a=`"${O.lodash.get(o,"name",n)}"`,u=O.lodash.get(t[n],"isActivated");return{name:a,isActivated:u}}),"name").filter(O.lodash.identity),"getColumnNames"),Ds=i((e,t)=>Object.keys(t).reduce((n,r)=>{let s=O.lodash.get(t,[r,"GUID"]),o=Object.keys(e).find(u=>e[u].definitionId===s),a=e[o];return{...n,[O.lodash.get(a,"name",r)]:t[r]}},{}),"getViewColumns"),zt=i((e=[],t)=>{let[n,r]=O.lodash.partition(e,c=>O.lodash.get(c,"isActivated",!0));if(O.lodash.isEmpty(e)||r.length===e.length)return"";let s=i(c=>`AND ${c} IS NOT NULL`,"generateNewStatement"),o=r.map(c=>s(c.name)).join(" "),a=ve(o,!1,t,"INLINE");return`WHERE ${[...n].reduce((c,l)=>c?`${c} ${s(l.name)}`:`${l.name} IS NOT NULL`,"")}${o?" "+a:""}`},"getWhereStatement"),xe=i((e,t,n={})=>t.reduce((r,s)=>{let o=O.lodash.get(e,[s,"name"]),u=ks(e,s,n).isActivated;return o?Object.assign({},r,{[s]:{name:o,isActivated:u}}):r},{}),"getNamesByIds"),Ht=i((e,t,n)=>{let r=M(t,0,"compositeClusteringKey",[]),s=xe(e,r.map(o=>o.keyId),n);return{clusteringKeys:r,clusteringKeysHash:s}},"getClusteringKeyData"),Gt=i((e,t,n)=>[...$e({collectionRefsDefinitionsMap:e,viewData:t,key:"compositePartitionKey",columns:n}),...$e({collectionRefsDefinitionsMap:e,viewData:t,key:"compositeClusteringKey",columns:n})],"getPrimaryKeys"),$e=i(({collectionRefsDefinitionsMap:e,viewData:t,key:n,columns:r})=>{let s=M(t,0,n,[]),o=xe(e,s.map(a=>a.keyId),r);return O.lodash.values(o).filter(O.lodash.identity).map(a=>({...a,name:`"${a.name}"`}))},"getCompositeKeys"),Yt=i(({collectionRefsDefinitionsMap:e,viewData:t,isParentActivated:n,columns:r})=>{let s=M(t,0,"compositePartitionKey",[]),o=xe(e,s.map(c=>c.keyId),r),a=Ht(e,t,r),u=xs(o,a.clusteringKeysHash,n);return u?`PRIMARY KEY (${u})`:""},"getPrimaryKeyScript"),Fs=i(e=>O.lodash.trim(e||"").replace(/  /g,"    "),"addTab"),be=i(({collectionRefsDefinitionsMap:e,viewData:t,columns:n,isParentActivated:r})=>{let s=Ht(e,t,n),o=M(t,0,"comments",""),a=M(t,0,"tableOptions","");return Fs(vs(s.clusteringKeys,s.clusteringKeysHash,"",a,o,r))},"getOptionsScript"),Ls=i(({viewData:e,entitySchema:t,entityData:n,entityName:r,isParentActivated:s,collectionRefsDefinitionsMap:o,columns:a})=>{let u=[],c=(t==null?void 0:t.properties)||{},l=Object.keys(c).reduce((N,d)=>{let p=t.properties[d];return{...N,[p.GUID]:p}},{}),m=Yt({entityFieldsMap:l,entityData:n,isParentActivated:s,columns:a}),y=be({collectionRefsDefinitionsMap:{},viewData:e,columns:a,isParentActivated:s});return u.push(`AS SELECT * FROM ${r}`),u.push(zt(Gt(o,n,a),s)),m&&u.push(m),y&&u.push(y),u},"getEmptyViewScript");Xt.exports={getOptionsScript:be,getViewScript({schema:e,entitySchema:t,viewData:n,entityData:r,containerData:s,collectionRefsDefinitionsMap:o,isKeyspaceActivated:a=!0,ifNotExist:u=!1}){let c=[],l=Ds(o,e.properties||{}),m=O.lodash.first(n)||{},y=bs(r),N=$s(s),d=N?`"${N}"."${y}"`:`"${y}"`,p=m.code||m.name,E=N?`"${N}"."${p}"`:`"${p}"`,S=Bt(r)&&Bt(n),f=a&&S,h=Yt({collectionRefsDefinitionsMap:o,viewData:n,isParentActivated:f,columns:l}),F=be({collectionRefsDefinitionsMap:o,viewData:n,columns:l,isParentActivated:f});if(c.push(`CREATE MATERIALIZED VIEW ${u?"IF NOT EXISTS ":""}${E}`),O.lodash.isEmpty(l))c=c.concat(Ls({viewData:n,entitySchema:t,entityData:r,entityName:d,isParentActivated:f,collectionRefsDefinitionsMap:o,columns:l}));else{let x=Ps(o,l),z=Rs(x,f);c.push(`AS SELECT ${z}`),c.push(`FROM ${d}`),c.push(zt(O.lodash.uniq([...Gt(o,n,l),...$e({collectionRefsDefinitionsMap:o,viewData:n,key:"whereClause",columns:l})]),f)),h&&c.push(h),F&&c.push(F)}return ve(c.join(`
  `)+";",S,a)}}});var en=I((Po,Jt)=>{"use strict";var{getViewScript:ws}=Re(),{dependencies:B}=$(),{AlterScriptDto:V}=Z(),Ks=i((e,t)=>`${e?`"${e}".`:""}"${t}"`,"getViewName"),js=["code","name"],Us=i(e=>{let t=js.some(o=>{let{new:a,old:u}=e[o]||{};return!B.lodash.isEqual(a,u)}),{tableOptions:n={},comments:r={}}=e;if(r.old&&!r.new)return!1;let s=Object.entries(n.old||{}).some(([o])=>{var a;return!((a=n.new)!=null&&a[o])});return!t&&!s},"getIsOnlyOptionsModify"),Qt=i((e,t)=>{if(!t||!B.lodash.isEqual(e,t))return e;if(!e)return t},"getProperty"),_s=i((e={},t={})=>{let n=Qt(t.new,t.old),{new:r={},old:s={}}=e,o=Object.entries(r).map(([a,u])=>[a,Qt(u,s[a])]).filter(([a,u])=>u);return{comments:n,tableOptions:Object.fromEntries(o)}},"getDifferentOptions"),Zt=i(e=>{var o,a;let{compMod:t,properties:n={}}=e.role,r=Object.entries(n).map(([u,c])=>[c.code||c.name||c.displayName||u,c]),s={containerData:[{name:t.keyspaceName}],schema:{properties:Object.fromEntries(r)},viewData:[e.role],ifNotExist:!0,collectionRefsDefinitionsMap:((o=t.collectionData)==null?void 0:o.collectionRefsDefinitionsMap)||{},entityData:((a=t.collectionData)==null?void 0:a.entityData)||[{}]};return ws(s)},"getAddView"),qs=i(e=>{var a,u,c;let t=((a=e.role)==null?void 0:a.compMod)||{};if(!Us(t)){let l=((u=t.code)==null?void 0:u.old)||((c=t.name)==null?void 0:c.old),m=B.provider.dropView({...e,role:{...e.role,code:l}}),y=Zt(e);return[V.getInstance([m],!0,"deletion","view"),V.getInstance([y],!0,"add","view")]}let{comments:r,tableOptions:s}=_s(t.tableOptions,t.comments),o={...e.role,comments:r,tableOptions:s};return[V.getInstance([B.provider.alterView(o)],!0,"modify","view")]},"getModifyView"),Ms=i(({child:e,mode:t})=>t==="add"?[V.getInstance([Zt(e)],!0,"add","view")]:t==="delete"?[V.getInstance([B.provider.dropView(e)],!0,"deletion","view")]:qs(e),"getViewScript");Jt.exports={getViewScript:Ms,getViewName:Ks}});var Xe=I((Fo,rn)=>{var g=Fe(),{tab:b,getTableNameStatement:te,getUserDefinedFunctions:Vs,getUserDefinedAggregations:Bs}=v(),{serializeOptions:Ws}=tt(),{getAlterTypePrefix:ke}=_t(),{getDiff:zs}=Vt(),{mergeValuesWithConfigOptions:Hs}=Q(),{parseToString:tn}=Ne(),{getViewName:nn}=en(),{getOptionsScript:Gs}=Re(),{wrapInQuotes:T}=ye(),W=i((e,t)=>t?`ALTER TABLE ${T(t)}.${T(e)}`:`ALTER TABLE ${T(e)}`,"alterTablePrefix");rn.exports=e=>{let{assignTemplates:t}=e.require("@hackolade/ddl-fe-utils");return{dropTable(n){return t(g.dropTable,{name:n})},createTable(n){if(!n.databaseName)return"";let{ifNotExist:r,databaseName:s,items:o,options:a}=n,u=r?"IF NOT EXISTS ":"";return t(g.createTable,{ifNotExistStatement:u,name:s,items:` (
`+o.map(c=>b(c)).join(`,
`)+`
)`,options:`${a}`})},dropDatabase(n){return n?t(g.dropDatabase,{name:n}):""},createCustomIndex(n){if(!n.tableName)return"";let{name:r,tableName:s,column:o,using:a,options:u,ifNotExist:c}=n,l=c?"IF NOT EXISTS ":"",m=a||"StorageAttachedIndex",y=Object.keys(u).length?`
`+b(`WITH OPTIONS = {
${b(Ws(u).join(`,
`))}
}`):"";return t(g.createCustomIndex,{ifNotExistStatement:l,name:`"${r}"`,tableName:s,column:o,usingStatement:m,optionsStatement:y})},createIndex(n){let{name:r,tableName:s,column:o,ifNotExist:a}=n,u=r?`"${r}"`:"",c=a?"IF NOT EXISTS ":"";return t(g.createIndex,{ifNotExistStatement:c,nameStatement:u,tableName:s,column:o})},createSearchIndex(n){let{ifNotExist:r,tableName:s,columnsStatement:o,profiles:a,config:u,options:c}=n,l=r?"IF NOT EXISTS ":"";return t(g.createSearchIndex,{ifNotExistStatement:l,tableName:s,columnsStatement:o,profiles:a,config:u,options:c})},dropType(n){let{keyspaceName:r,typeName:s}=n;return t(g.dropType,{keyspaceName:T(r),typeName:T(s)})},renameColumn(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(g.renameColumn,{alterTablePrefixStatement:a,oldName:T(o.oldName),newName:T(o.newName)})},addEntity(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(g.addEntity,{alterTablePrefixStatement:a,name:T(o.name),type:o.type})},deleteEntity(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(g.deleteEntity,{alterTablePrefixStatement:a,name:T(o.name)})},addPropertyToUdt(n){let{keySpaceName:r,udtName:s,type:o}=n,a=ke(r);return t(g.addPropertyToUdt,{alterTypePrefixStatement:a,udtName:T(s),name:T(s),type:o})},createUdt(n){let{keySpaceName:r,udtName:s,columnScript:o}=n;return t(g.createUdt,{keySpaceName:T(r),udtName:T(s),columnScript:b(o)})},updateUdtType(n){let{keySpaceName:r,udtName:s,columnData:o}=n,a=ke(r);return t(g.updateUdtType,{alterTypePrefixStatement:a,udtName:T(s),name:T(o.name),type:o.type})},renameType(n){let{keySpaceName:r,udtName:s,oldFieldName:o,newFieldName:a}=n,u=ke(r);return t(g.renameType,{alterTypePrefixStatement:u,udtName:T(s),oldFieldName:T(o),newFieldName:T(a)})},updateType(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(g.updateType,{alterTablePrefixStatement:a,name:T(o.name),type:o.type})},updateTableOptions(n,r,s){if(!s||!n)return"";let{keyspaceName:o,tableOptions:a={},comments:u}=n,c=i(d=>(d==null?void 0:d.new)&&d.new!==d.old,"isCommentNew"),l=W(r,o),m=zs(a.new||{},a.old||{}),y=Hs(m),N=c(u)?tn(y,u.new):tn(y);return N?t(g.updateTableOptions,{alterTablePrefixStatement:l,optionsStatement:b(N)}):""},dropSearchIndexConfig(n,r,s){let o=te(n,r);return t(g.dropSearchIndexConfig,{tableNameStatement:o,indexName:s})},modifySearchIndex(n,r,s,o){let a=te(n,r);return t(g.modifySearchIndex,{tableNameStatement:a,key:s,value:o})},dropSearchIndex(n,r){let s=te(n,r);return t(g.dropSearchIndex,{tableNameStatement:s})},dropIndex(n,r){let s=te(n,r);return t(g.dropIndex,{tableNameStatement:s})},dropKeySpace(n){return t(g.dropKeySpace,{keySpaceName:T(n)})},createKeySpace(n,r,s,o,a){let u=Vs(o),c=Bs(a);return t(g.createKeySpace,{keySpaceName:T(n),replication:b(r),durableWrites:b(s),udfScript:u,udaScript:c})},alterKeySpaceReplication(n,r,s){return t(g.alterKeySpaceReplication,{keySpaceName:T(n),replication:b(r),durableWrites:b(s,2)})},dropView(n){let{compMod:r,name:s,code:o}=n.role,a=nn(r.keyspaceName,o||s);return t(g.dropView,{viewName:a})},alterView(n){var u;let r=[n],s=Gs({collectionRefsDefinitionsMap:((u=n.compMod.collectionData)==null?void 0:u.collectionRefsDefinitionsMap)||{},viewData:r}),o=n.name||n.code,a=n.compMod.keyspaceName;if(s){let c=nn(a,o);return t(g.alterView,{keySpaceViewName:c,optionScript:b(s)})}return""}}}});module.exports=Xe();
