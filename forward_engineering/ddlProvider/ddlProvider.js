"use strict";var an=Object.defineProperty;var i=(e,t)=>an(e,"name",{value:t,configurable:!0});var I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Le=I((to,De)=>{"use strict";De.exports={dropTable:"DROP TABLE IF EXISTS ${name};",createTable:"CREATE TABLE ${ifNotExistStatement}${name}${items}${options};",dropDatabase:"DROP DATABASE IF EXISTS ${name};",createCustomIndex:"CREATE CUSTOM INDEX ${ifNotExistStatement}${name}\n  ON ${tableName} (${column})\n  USING '${usingStatement}'${optionsStatement};",createIndex:"CREATE INDEX ${ifNotExistStatement}${nameStatement}\n  ON ${tableName} (${column});",createSearchIndex:"CREATE SEARCH INDEX ${ifNotExistStatement}ON ${tableName}\n  WITH COLUMNS\n${columnsStatement}${profiles}${config}${options};",dropType:"DROP TYPE IF EXISTS ${keyspaceName}.${typeName};",renameColumn:"${alterTablePrefixStatement} RENAME ${oldName} TO ${newName};",addEntity:"${alterTablePrefixStatement} ADD ${name} ${type};",deleteEntity:"${alterTablePrefixStatement} DROP ${name};",addPropertyToUdt:"${alterTypePrefixStatement}.${udtName} ADD ${name} ${type};",createUdt:"CREATE TYPE IF NOT EXISTS ${keySpaceName}.${udtName} (\n${columnScript} \n);",updateUdtType:"${alterTypePrefixStatement}.${udtName}\nALTER ${name} TYPE ${type};",renameType:"${alterTypePrefixStatement}.${udtName} \n	RENAME ${oldFieldName} TO ${newFieldName};",updateType:"${alterTablePrefixStatement} \n	ALTER ${name} TYPE ${type};",updateTableOptions:"${alterTablePrefixStatement}${optionsStatement};",dropSearchIndexConfig:"ALTER SEARCH INDEX CONFIG\n  ON ${tableNameStatement}\n    DROP ${indexName};",modifySearchIndex:"ALTER SEARCH INDEX CONFIG\n  ON ${tableNameStatement}\n    SET ${key} = ${value};",dropSearchIndex:"DROP SEARCH INDEX ON ${tableNameStatement};",dropIndex:"DROP INDEX IF EXISTS ${tableNameStatement};",dropKeySpace:"DROP KEYSPACE IF EXISTS ${keySpaceName};",createKeySpace:"CREATE KEYSPACE IF NOT EXISTS ${keySpaceName} \n${replication}\n${durableWrites}${udfScript}${udaScript};",alterKeySpaceReplication:"ALTER KEYSPACE ${keySpaceName} \n${replication}\n${durableWrites};",dropView:"DROP MATERIALIZED VIEW IF EXISTS ${viewName};",alterView:"ALTER MATERIALIZED VIEW ${keySpaceViewName}\n${optionScript};"}});var se=I((no,we)=>{"use strict";var Fe=require("fs"),w=require("path"),ne=i(e=>{try{let t=Fe.readFileSync(w.join(__dirname,"..",e));return JSON.parse(t.toString().replace(/\/\*[\s\S]*?\*\//g,""))}catch{return{}}},"getConfig"),re=i(e=>{let t;return(...n)=>(t||(t=e(...n)),t)},"cacheResult"),cn=re(()=>ne(w.join("properties_pane","field_level","fieldLevelConfig.json"))),un=re(()=>ne(w.join("properties_pane","entity_level","entityLevelConfig.json"))),dn=re(()=>{let e=i(r=>r.replace(/\.json/,""),"getName"),t=w.join(__dirname,"..","types");return Fe.readdirSync(t).reduce((r,s)=>(r[e(s)]=ne(w.join("types",s)),r),{})});we.exports={getEntityLevelConfig:un,getFieldLevelConfig:cn,getTypesConfig:dn}});var v=I((oo,qe)=>{"use strict";var{getEntityLevelConfig:so,getFieldLevelConfig:ln,getTypesConfig:mn}=se(),pn=2,yn=i((e="")=>e.startsWith("DSE")&&(e.split(" ")[1]||"").split(".")[0]||"","getDataStaxVersion"),fn=i((e,t=1)=>{let n=" ".repeat(t*pn);return e.split(`
`).map(r=>n+r).join(`
`)},"tab"),R=i((e,t,n,r="")=>((e||[])[t]||{})[n]||r,"retrivePropertyFromConfig"),gn=i(e=>R(e,0,"code",R(e,0,"name","")),"retrieveContainerName"),Nn=i(e=>R(e,0,"code",R(e,0,"collectionName","")),"retrieveEntityName"),Sn=i(e=>R(e,1,"UDFs",[]),"retrieveUDF"),Tn=i(e=>R(e,2,"UDAs",[]),"retrieveUDA"),En=i((e,t)=>{let n=e[1],r={indexes:R(e,1,"SecIndxs",[])};return n.searchIndex&&(r.searchIndex={indexType:"search",columns:n.searchIndexColumns,config:n.searchIndexConfig,profiles:je(n.searchIndexProfiles,t),options:n.searchIndexOptions,ifNotExist:n.searchIndexIfNotExist}),r},"retrieveIndexes"),Ke=i((e,t)=>e.filter(n=>!t.includes(n)),"filterSpaceSaving"),je=i((e,t)=>{let n=yn(t),s=[(n.length?Number(n)>=6:!1)?"spaceSavingNoTextfield":""];return e=Array.isArray(e)?e:[e].filter(Boolean),e=Ke(e,s),Ke(["spaceSavingNoJoin","spaceSavingNoTextfield","spaceSavingSlowTriePrecision"],s).every(u=>e.includes(u))?["spaceSavingAll"]:e},"getIndexProfiles"),In=i((e,t)=>Ue(e,`"${t}"`),"getTableNameStatement"),Ue=i((e,t)=>`${e?`"${e}".`:""}${t}`,"getNameWithKeyspace"),On=i(e=>mn()[e],"getTypeConfig"),_e=i((e,t)=>{let n=ln().structure;return n[e]?n[e].find(s=>s.propertyKeyword===t):void 0},"getFieldConfig"),oe=i((e,t)=>{let n=Object.assign({},e),r=i((o,a)=>Object.keys(o).reduce((u,c)=>{let l=o[c];return u[c]=a(oe(l,a),c),u},{}),"eachProperty"),s=i((o,a)=>o.map((u,c)=>a(oe(u,a),c)),"eachItem");if(n.hasOwnProperty("properties")&&(n.properties=r(n.properties,t)),n.hasOwnProperty("items")){let o=Array.isArray(n.items)?n.items:[n.items];n.items=s(o,t)}return n},"eachField"),hn=i((e,t)=>{let n=_e(e,"mode")||{};return Array.isArray(n.options)?n.options.includes(t):!1},"canTypeHaveSubtype"),An=i((e,t=!0,n=!0,r=!0)=>{if(t||!n||!e)return e;let s=i((a,u="-- ")=>a.split(`
`).map(c=>`${u}${c}`).join(`
`),"insertBeforeEachLine");return r?i(a=>`/*
${s(a,"  ")}
*/`,"multiLineComment")(e):s(e)},"commentDeactivatedStatement"),Cn=i(e=>{var n;let t=(n=e==null?void 0:e[0])==null?void 0:n.isActivated;return t===void 0?!0:t},"retrieveIsItemActivated"),$n=i(e=>e.map(t=>t.functionBody).filter(t=>t).join(`
`),"getUserDefinedFunctions"),bn=i(e=>e.map(t=>t.storedProcFunction).filter(t=>t).join(`
`),"getUserDefinedAggregations"),vn=i(e=>{let{applyDropStatements:t,additionalOptions:n=[]}=e.options||{},r=(n.find(s=>s.id==="applyDropStatements")||{}).value;return t||r},"getApplyDropStatement");qe.exports={tab:fn,retrieveContainerName:gn,retrieveEntityName:Nn,retrieveUDF:Sn,retrieveUDA:Tn,retrieveIndexes:En,retrivePropertyFromConfig:R,getTableNameStatement:In,getFieldConfig:_e,getTypeConfig:On,getNameWithKeyspace:Ue,eachField:oe,canTypeHaveSubtype:hn,commentDeactivatedStatement:An,retrieveIsItemActivated:Cn,getUserDefinedAggregations:bn,getUserDefinedFunctions:$n,getIndexProfiles:je,getApplyDropStatement:vn}});var K=I((ao,ze)=>{"use strict";var Me="LINE",Ve="INLINE",ie="MULTILINE",Be=i((e,t="-- ")=>e.split(`
`).map(n=>n&&`${t}${n}`).join(`
`),"insertBeforeEachLine"),xn=i(e=>`/*
${Be(e,"  ")}
*/`,"multiLineComment"),We=i(e=>`/* ${e} */`,"inlineComment"),Rn=i((e,t=!0,n=!0,r=ie)=>{if(t||!n||!e)return e;switch(r){case ie:return xn(e);case Ve:return We(e);case Me:return Be(e);default:return e}},"commentDeactivatedStatement");ze.exports={commentDeactivatedStatement:Rn,inlineComment:We,LINE:Me,INLINE:Ve,MULTILINE:ie}});var G=I((uo,Ge)=>{"use strict";var kn=["isActivated","type","compositePartitionKey"],He=i((e={},t=!1)=>t?e:kn.reduce((n,r)=>!e.hasOwnProperty(r)||e[r]===void 0?n:{...n,[r]:e[r]},{}),"getAttributes"),j=i((e,t,n)=>{if(e.GUID===t||e.id===t)return n;if(e.properties)return Object.keys(e.properties).reduce((r,s)=>{if(r)return r;{let o=e.properties[s];return j(o,t,[...n,o.GUID||o.id])}},void 0);if(e.items)return Array.isArray(e.items)?e.items.reduce((r,s)=>r||j(s,t,[...n,s.GUID||s.id]),void 0):j(e.items,t,[...n,e.items.GUID])},"getPathById"),Pn=i((e,t,n)=>{let r=Object.keys(t).find(o=>t[o].GUID===e||t[o].id===e),s=t[r];return s&&(s.code||s.name)?{name:s.code||s.name,...He(t[r],n)}:{name:r,...He(t[r],n)}},"getRootItemMetadataById"),Dn=i((e,t,n)=>{let r=j(t,e,[]);return r?Pn(r[0],t.properties,n):{name:""}},"findFieldMetadataById"),Ln=i((e,t,n)=>e.reduce((r,s)=>{for(let o=0;o<t.length;o++){let a=Dn(s,t[o],n);if(a!=null&&a.name)return Object.assign({},r,{[s]:a})}return r},{}),"getAttributesDataByIds");Ge.exports={getPathById:j,getNamesByIds:Ln}});var $=I((mo,Ye)=>{"use strict";var ae={},Fn=i(e=>{ae.lodash=e.require("lodash"),ae.provider=Xe()(e)},"setDependencies");Ye.exports={setDependencies:Fn,dependencies:ae}});var tt=I((yo,et)=>{"use strict";var{commentDeactivatedStatement:wn,inlineComment:Kn}=K(),{tab:U,getTableNameStatement:jn}=v(),{getNamesByIds:Qe}=G(),{dependencies:ce}=$(),Un=i((e,t,n,r,s,o,a)=>{let u=jn(r,n),c=s&&o,l=_n(u,t,e.indexes),m=a==="Astra DB"?[]:qn(u,t,c,e.searchIndex);return[...l,...m].map(g=>wn(g.statement,g.isActivated,c)).join(`

`)},"getIndexes"),_n=i((e,t,n=[])=>Bn(n).map(r=>{let s,o=r.isActivated&&Je(r.SecIndxKey,t),a=Ze(r.SecIndxKey,t);return r.indexType==="custom"?s=ce.provider.createCustomIndex({name:r.name,tableName:e,column:a,using:r.isSASI?"org.apache.cassandra.index.sasi.SASIIndex":"StorageAttachedIndex",options:zn(r.customOptions,r.isSASI),ifNotExist:r.indexIfNotExist}):s=ce.provider.createIndex({name:r.name,tableName:e,column:a,ifNotExist:r.indexIfNotExist}),{isActivated:o,statement:s}}),"getGeneralIndexes"),qn=i((e,t,n,r)=>{if(!r)return[];let s=[];r.columns&&(s=Mn(r.columns.filter(c=>Array.isArray(c.key)&&c.key.length).map(c=>({...c,name:Ze(c.key[0],t),isActivated:Je(c.key[0],t)}))));let a=s.filter(c=>c.isActivated).length>0,u=Hn({tableName:e,isActivated:a&&n,index:r,columns:s,ifNotExist:r.ifNotExist});return[{isActivated:a,statement:u}]},"getSearchIndexStatement"),Mn=i(e=>e.reduce((t,n)=>t.find(s=>s.name===n.name)?t:t.concat(n),[]),"uniqueByName"),Ze=i((e,t)=>{let{name:n}=Qe([e.keyId],t)[e.keyId]||{};return n?Vn(`"${n}"`,e.type):""},"getIndexColumnStatement"),Vn=i((e,t)=>t==="keys"?`KEYS(${e})`:t==="values"?`VALUES(${e})`:t==="entries"?`ENTRIES(${e})`:t==="full"?`FULL(${e})`:e,"wrapKey"),Je=i((e,t)=>{let{isActivated:n}=Qe([e.keyId],t)[e.keyId]||{};return n!==!1},"isIndexColumnKeyActivated"),Bn=i(e=>e.reduce((t,n)=>[...t,...(n.SecIndxKey||[]).map((r,s)=>Object.assign({},n,{name:s>0?n.name+"_"+s:n.name,SecIndxKey:r}))],[]),"unwindIndexes"),Wn=i(e=>Object.keys(e).map(t=>`'${t}': '${e[t]}'`),"serializeOptions"),zn=i((e,t)=>{let n={};return!e||(e.case_sensitive&&(n.case_sensitive="true"),e.normalize&&(n.normalize="true"),e.ascii&&!t&&(n.ascii="true"),e.similarity_function&&!t&&(n.similarity_function=`${e.similarity_function}`),!t)||(e.analyzed&&(n.analyzed="true"),e.isLiteral&&(n.is_literal="true"),e.tokenizationEnableStemming&&(n.tokenization_enable_stemming="true"),e.tokenizationNormalizeLowercase&&(n.tokenization_normalize_lowercase="true"),e.tokenizationNormalizeUppercase&&(n.tokenization_normalize_uppercase="true"),e.normalizeLowercase&&(n.normalize_lowercase="true"),e.normalizeUppercase&&(n.normalize_uppercase="true"),e.tokenizationLocale&&(n.tokenization_locale=`${e.tokenizationLocale}`),e.tokenizationSkipStopWords&&(n.tokenization_skip_stop_words=`${e.tokenizationSkipStopWords}`),e.mode&&(n.mode=`${e.mode}`),e.analyzerClass&&(n.analyzer_class=`${e.analyzerClass}`),e.maxCompactionFlushMemoryInMb&&(n.max_compaction_flush_memory_in_mb=`${e.maxCompactionFlushMemoryInMb}`)),n},"getCustomOptions"),Hn=i(({tableName:e,columns:t,index:n,isActivated:r,ifNotExist:s})=>{let o=Yn(Gn(t),r),a=n.profiles.length?`
${U(`AND PROFILES ${n.profiles.join(", ")}`)}`:"",u=Xn(n.config),c=u?`
${U(`AND CONFIG ${u}`)}`:"",l=Qn(n.options),m=l?`
${U(`AND OPTIONS ${l}`)}`:"";return ce.provider.createSearchIndex({ifNotExist:s,tableName:e,columnsStatement:U(o,2),profiles:a,config:c,options:m})},"getSearchIndex"),Gn=i(e=>e.map(t=>{let n=[];return t.copyField&&n.push("copyField: true"),t.docValues&&n.push("docValues: true"),t.excluded&&n.push("excluded: true"),t.indexed||n.push("indexed: false"),t.lowerCase&&n.push("lowerCase: true"),{statement:`${t.name}${n.length?` {${n.join(", ")}}`:""}`,isActivated:t.isActivated}}),"getSearchIndexColumns"),Yn=i((e,t)=>{let n=t?e.filter(a=>!a.isActivated):[],r=t?e.filter(a=>a.isActivated):e,s=n.length?n.map(({statement:a})=>a).join(`,
`).split(`
`).map(Kn).join(`
`):"",o=r.map(({statement:a})=>a).join(`,
`);return s&&o?s+`,
`+o:s||o},"getSearchIndexColumnStatements"),Xn=i((e={})=>{let t=[];return e.autoCommitTime&&e.autoCommitTime!==1e4&&t.push(`autoCommitTime: ${e.autoCommitTime}`),e.defaultQueryField&&t.push(`defaultQueryField: '${e.defaultQueryField}'`),e.directoryFactory&&t.push(`directoryFactory: '${e.directoryFactory}'`),e.filterCacheLowWaterMark&&e.filterCacheLowWaterMark!==1024&&t.push(`filterCacheLowWaterMark: ${e.filterCacheLowWaterMark}`),e.filterCacheHighWaterMark&&e.filterCacheHighWaterMark!==2048&&t.push(`filterCacheHighWaterMark: ${e.filterCacheHighWaterMark}`),e.directoryFactoryClass&&t.push(`directoryFactoryClass: '${e.directoryFactoryClass}'`),e.mergeMaxThreadCount&&e.mergeMaxMergeCount&&(t.push(`mergeMaxThreadCount: ${e.mergeMaxThreadCount}`),t.push(`mergeMaxMergeCount: ${e.mergeMaxMergeCount}`)),e.ramBufferSize&&e.ramBufferSize!==512&&t.push(`ramBufferSize: ${e.ramBufferSize}`),e.realtime&&t.push("realtime: true"),t.length?`{
${U(t.join(`,
`))}
}`:""},"getSearchIndexConfig"),Qn=i((e={})=>{let t=[];return e.recovery&&t.push("recovery: true"),e.reindex||t.push("reindex: false"),e.lenient&&t.push("lenient: true"),t.length?`{${t.join(", ")}}`:""},"getSearchIndexOptions");et.exports={getIndexes:Un,serializeOptions:Wn}});var Y=I((go,ct)=>{"use strict";var{getFieldConfig:rt,getTypeConfig:nt,canTypeHaveSubtype:Zn}=v(),st=i(e=>{let t,n=i((r,s)=>{if(r===e)t=s;else if(r===void 0)return t;return n},"handler");return n},"ifType"),ue=i((e,t,n)=>{if(e){let r=rt(e,"mode"),s=r!=null&&r.options?r.options[0]:e;return me(e,n)({type:e,mode:s,frozen:!0,keyType:"char",keySubtype:"text",items:{type:"char",mode:"varchar"},properties:{field:{type:"char",mode:"varchar"}}})}return t},"getModeType"),ot=i((e,t)=>{let n=i(o=>o.type,"simpleType"),r=i(o=>`'${o.subType||"PointType"}'`,"geoSpatialType"),s=i(o=>{if(o.physicalType)return me(o.physicalType)(Object.assign(o,{type:o.physicalType}))},"getJsonType");return st(e)("char",o=>o.mode||"text")("numeric",o=>{let a=o.mode||"integer";return a==="integer"?"int":a})("binary",()=>"blob")("bool",()=>"boolean")("blob",n)("timestamp",n)("date",n)("time",n)("duration",n)("uuid",n)("timeuuid",n)("DseExecutorStateType",o=>`'${n(o)}'`)("DateRangeType",o=>`'${n(o)}'`)("geospatial",r)("udt",(o,a)=>de(a,t)())("jsonObject",s)("jsonArray",s)()},"getScalarType"),it=i((e,t,n)=>{let r=i(d=>!!d.frozen,"isFrozen"),s=i(d=>p=>{let E=d(p);return r(p)?le(E):E},"setFrozen"),o=i((d,p,E,S)=>{var f,h,L,x,z,Pe;if(d.items)if(Array.isArray(d.items)){let F=((f=d.items[0])==null?void 0:f.code)||((h=d.items[0])==null?void 0:h.name)||((L=d.items[0])==null?void 0:L.displayName);return u(d.items[0],r(d),F||0)}else{let F=((x=d.items)==null?void 0:x.code)||((z=d.items)==null?void 0:z.name)||((Pe=d.items)==null?void 0:Pe.displayName);return u(d.items,r(d),F||0)}else{let F=nt(d.type);if(F.subtypes&&d.subtype){let H=F.subtypes[d.subtype];if(H!=null&&H.childValueType)return ue(H.childValueType,p,E)}}return p},"getValueTypeFromArray"),a=i((d,p,E)=>{if(d.properties){let S=Object.keys(d.properties)[0];if(S){let f=d.properties[S];return u(f,r(d),S)}}else{let S=nt(d.type);if(S.subtypes&&d.subtype){let f=S.subtypes[d.subtype];if(f!=null&&f.childValueType)return ue(f.childValueType,p,E)}}return p},"getValueTypeFromObject"),u=((d,p)=>(E,S,f)=>{if(E){let h=Jn(E,!S&&d,p,f);if(h!==void 0)return h}else return"text"})(t,n),c=i((d,p)=>`set<${o(d,"varchar",n,p)}>`,"typeSet"),l=i((d,p)=>`list<${o(d,"text",n,p)}>`,"list"),m=i((d,p)=>`tuple<${(Array.isArray(d.items)?d.items:[d.items]).map((S,f)=>u(S,!0,f)).join(", ")}>`,"tuple"),y=i((d,p)=>{let E=Zn(d.keyType,d.keySubtype)?d.keySubtype:ue(d.keyType,"text",n),S=a(d,"text",n);return`map<${E}, ${S}>`},"map"),g=i((d,p)=>{let E=o(d,"float",n,p),S=tr(d);return`vector<${E}, ${S}>`},"vector");return st(e)("map",s(y))("list",s(l))("set",s(c))("vector",s(g))("tuple",m)()},"getStructuralTypeHandler"),de=i((e,t,n)=>()=>{let r=t[e]||{};return r.frozen&&!n?le(r.name):r.name},"getUDTHandler"),le=i(e=>e===void 0?void 0:`frozen<${e}>`,"getFrozen"),me=i((e,t)=>ot(e,t)||it(e,!0,t)||de(e,t),"getHandlerByType"),Jn=i((e,t,n,r)=>{let s=at(e),o=ot(s,n);if(o)return o(e,r);let a=(it(s,!1,n)||de(s,n,t))(e,r);return t?le(a):a},"getNestedTypeByData"),at=i(e=>e.$ref?e.$ref.split("/definitions/").pop():e.type?e.type:"char","getTypeByPropertyData"),er=i((e,t,n)=>{let r=at(e);return me(r,t)(e,n)},"getTypeByData"),tr=i(e=>{if(!isNaN(+e.dimension))return e.dimension;let t=rt(e.type,"dimension");return t==null?void 0:t.defaultValue},"getVectorDimension");ct.exports={getTypeByData:er}});var dt=I((So,ut)=>{"use strict";var nr=i(({index:e,numberOfStatements:t,lastIndexOfActivatedStatement:n,delimiter:r})=>{let s=e===t-1,o=e===n;return s?"":o?" --"+r:r},"getDelimiter"),rr=i(({statements:e=[],delimiter:t=",",indent:n=`
`})=>{let r=e.findLastIndex(o=>!o.startsWith("--")),s=e.length;return e.map((o,a)=>{let u=nr({index:a,numberOfStatements:s,lastIndexOfActivatedStatement:r,delimiter:t});return o+u}).join(n)},"joinActivatedAndDeactivatedStatements");ut.exports={joinActivatedAndDeactivatedStatements:rr}});var pe=I((Eo,lt)=>{"use strict";var{getTypeByData:sr}=Y(),{commentDeactivatedStatement:or}=v(),{joinActivatedAndDeactivatedStatements:ir}=dt();lt.exports={getColumnDefinition(e,t={},n=!1){let r=Object.keys(e).map(s=>{let o=e[s],a=ur(o,t,s);if(a===void 0)return"";{let u=cr(o.code||s,a,ar(o));return or(u,o.isActivated,n,!1)}}).filter(s=>s);return ir({statements:r,indent:`
`})}};var ar=i(e=>!!(e||{}).static,"isStatic"),cr=i((e,t,n)=>`"${e}" ${t}${n?" STATIC":""}`,"getColumn"),ur=i((e,t,n)=>sr(e,t,n),"getTypeDefinition")});var pt=I((Oo,mt)=>{"use strict";var dr=Object.freeze({ADD:"ADD",AGGREGATE:"AGGREGATE",ALLOW:"ALLOW",ALTER:"ALTER",AND:"AND",ANY:"ANY",APPLY:"APPLY",ASC:"ASC",AUTHORIZE:"AUTHORIZE",BATCH:"BATCH",BEGIN:"BEGIN",BY:"BY",COLUMNFAMILY:"COLUMNFAMILY",CREATE:"CREATE",DELETE:"DELETE",DESC:"DESC",DROP:"DROP",EACH_QUORUM:"EACH_QUORUM",ENTRIES:"ENTRIES",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",IF:"IF",IN:"IN",INDEX:"INDEX",INET:"INET",INFINITY:"INFINITY",INSERT:"INSERT",INTO:"INTO",KEYSPACE:"KEYSPACE",KEYSPACES:"KEYSPACES",LIMIT:"LIMIT",LOCAL_ONE:"LOCAL_ONE",LOCAL_QUORUM:"LOCAL_QUORUM",MATERIALIZED:"MATERIALIZED",MODIFY:"MODIFY",NAN:"NAN",NORECURSIVE:"NORECURSIVE",NOT:"NOT",OF:"OF",ON:"ON",ONE:"ONE",ORDER:"ORDER",PARTITION:"PARTITION",PASSWORD:"PASSWORD",PER:"PER",PRIMARY:"PRIMARY",QUORUM:"QUORUM",RENAME:"RENAME",REVOKE:"REVOKE",SCHEMA:"SCHEMA",SELECT:"SELECT",SET:"SET",TABLE:"TABLE",TIME:"TIME",THREE:"THREE",TO:"TO",TOKEN:"TOKEN",TRUNCATE:"TRUNCATE",TWO:"TWO",UNLOGGED:"UNLOGGED",UPDATE:"UPDATE",USE:"USE",USING:"USING",VIEW:"VIEW",WHERE:"WHERE",WITH:"WITH"}),lr=Object.values(dr);mt.exports={ReservedWordsAsArray:lr}});var ye=I((ho,ft)=>{"use strict";var{dependencies:yt}=$(),{ReservedWordsAsArray:mr}=pt(),pr=i((e,t)=>[...e,...t],"mergeArrays"),yr={blob:["ascii","bigint","boolean","decimal","double","float","inet","int","timestamp","timeuuid","uuid","varchar","varint"],varint:["int"],varchar:["text"],uuid:["timeuuid"],text:["varchar"]},fr=i(e=>{let t=e.filter(r=>r.dbVersion)[0].dbVersion,n=t.search(/\d/);if(n!==-1)return t[n]<3},"checkIsOldModel"),gr=i((e,t)=>{let n=yr[t];return!(!n||!n.filter(s=>s===e).length)},"fieldTypeCompatible"),Nr=i(e=>/\s|\W/.test(e)||yt.lodash.includes(mr,yt.lodash.toUpper(e))?`"${e}"`:e,"wrapInQuotes");ft.exports={mergeArrays:pr,checkIsOldModel:fr,fieldTypeCompatible:gr,wrapInQuotes:Nr}});var ge=I((Co,Ot)=>{"use strict";var{inlineComment:gt}=K(),{dependencies:Nt}=$(),Sr="numeric",Tr="text",Er="details",Ir="checkbox",Tt="otherProperties",Et="caching",Or=[Et,Tt],X=i(e=>e===""?`
WITH`:"  AND","getStringStart"),It=i(e=>String(e||"").replace(/[\"\`]/g,"'"),"changeQuotes"),St={localReadRepairChance:"dclocal_read_repair_chance",readRepairChance:"read_repair_chance",gcGraceSeconds:"gc_grace_seconds",bloomFilterFalsePositiveChance:"bloom_filter_fp_chance",defaultTtl:"default_time_to_live",speculativeRetry:"speculative_retry",minIndexInterval:"min_index_interval",maxIndexInterval:"max_index_interval",crcCheckChance:"crc_check_chance",memtableFlushPeriod:"memtable_flush_period_in_ms"},fe=i(e=>St.hasOwnProperty(e)?St[e]:e,"convertKeywordToTableOptionName"),hr=i(e=>Or.includes(e.propertyKeyword)?Ar(e):Cr(e),"transformOption"),Ar=i(e=>{switch(e.propertyKeyword){case Et:return kr(e);case Tt:return xr(e);default:return null}},"transformSpecialOption"),Cr=i(e=>{switch(e.propertyType){case Tr:return $r(e);case Ir:return Rr(e);case Sr:return br(e);case Er:return vr(e);default:return null}},"transformOptionByPropertyType"),$r=i(e=>`${fe(e.propertyKeyword)} = '${e.value}'`,"transformTextOption"),br=i(e=>`${fe(e.propertyKeyword)} = ${e.value}`,"transformNumericOption"),vr=i(e=>{let r=i(s=>typeof s=="object"?JSON.stringify(e.value):s,"getStringValue")(e.value).replace(/\n/g,"");return`${fe(e.propertyKeyword)} = ${It(r)}`},"transformDetailsOptions"),xr=i(e=>e.value.reduce((n,r)=>{let{name:s,value:o}=r;if(!s||!o)return n;let a=n===""?"":"  AND";return n.concat(`${a} ${s} = '${o}'
`)},"").replace(/\n$/,""),"transformOtherOptions"),Rr=i(e=>{let t=e.propertyKeyword;return e.value?t==="cdc"?"cdc = TRUE":t==="compactStorage"?"COMPACT STORAGE":null:null},"transformBooleanOption"),kr=i(e=>{let t=i(c=>s.includes(c)?c:null,"validateKeys"),n=i(c=>s.includes(c)?c:isNaN(c)?null:Number(c),"validateRows"),r=i((c,l)=>Object.assign({},c&&{keys:c},l&&{rows_per_partition:l}),"createValueObject"),s=["ALL","NONE"],o=t(e.value.keys),a=n(e.value.rowsPerPartition);if(!o&&!a)return null;let u=JSON.stringify(r(o,a));return`caching = ${It(u)}`},"transformCachingOption"),Pr=i((e,t)=>{if(!t.value&&typeof t.value!="number")return e;let n=hr(t);if(!n)return e;let r=X(e);return e.concat(`${r} ${n}
`)},"generateOptionsStringReducer"),Dr=i((e,t)=>{if(t){let n=X(e);return e.concat(`${n} comment = '${t}'
`)}return e},"addCommentToOptionString"),Lr=i((e,t)=>{if(!e)return t;let n=X(t);return t.concat(`${n} ID = '${e}'
`)},"addId"),Fr=i((e,t,n,r)=>{let s=e.filter(m=>t[m&&m.keyId]);if(!s.length)return n;let o=i(m=>m.map(y=>{let{keyId:g,type:d}=y,{name:p}=t[g];return`"${p}" ${d==="descending"?"DESC":"ASC"}`}),"mapKeys"),[a,u]=Nt.lodash.partition(s,({keyId:m})=>Nt.lodash.get(t,`${m}.isActivated`)!==!1);a=o(a),u=o(u);let c;r?u.length===0?c=a.join(", "):a.length===0?c=gt(u.join(", ")):c=`${a.join(", ")} ${gt(`, ${u.join(", ")}`)}`:c=o(s).join(", ");let l=X(n);return n.concat(`${l} CLUSTERING ORDER BY (${c})
`)},"addClustering");Ot.exports={parseToString(e,t){let n=e.reduce(Pr,"");return Dr(n,t)},addId:Lr,addClustering:Fr}});var Q=I((bo,Rt)=>{"use strict";var{retrieveContainerName:wr,retrieveEntityName:Kr,retrivePropertyFromConfig:P,getTableNameStatement:jr,commentDeactivatedStatement:Ur}=v(),{getColumnDefinition:_r}=pe(),{getNamesByIds:ht}=G(),{getEntityLevelConfig:qr}=se(),{parseToString:Mr,addId:Vr,addClustering:Br}=ge(),{inlineComment:At}=K(),{dependencies:bt}=$(),Wr=i((e,t,n,r,s,o)=>{let a=[];return n&&a.push(n),r&&a.push(`PRIMARY KEY (${r})`),bt.provider.createTable({ifNotExist:o,databaseName:jr(e,t),items:a,options:s})},"getCreateTableStatement"),Ct=i((e,t,n)=>{let r=zr(e,n),s=Hr(t,n),o=[];return r&&o.push(r),s&&o.push(s),o.join(s.startsWith("/*")||r.endsWith("*/")?" ":", ")},"getPrimaryKeyList"),zr=i((e,t)=>{let n=Object.keys(e);if(n.length){let r=xt(n,e,t);return n.length>1?`(${r})`:r}else return""},"getPartitionKeys"),Hr=i((e,t)=>{let n=Object.keys(e);return n.length?xt(n,e,t):""},"getClusteringKeys"),Gr=i((e,t)=>e.map(n=>{let r=t[n.propertyKeyword];return r===void 0?n:Object.assign({},n,{value:r})}),"seedOptionsWithValues"),Yr=i(e=>e.structure.find(n=>n.propertyName==="Options").structure,"getOptionsFromTab"),vt=i(e=>{let[t]=qr(),n=Yr(t);return Gr(n,e)},"mergeValuesWithConfigOptions"),$t=i((e,t,n,r,s,o)=>{let a=vt(r),u=Vr(n,Br(e,t,Mr(a,s),o));return u?u.replace(/\n$/,""):""},"getOptions"),xt=i((e,t,n)=>{let r=i(a=>a.map(u=>t[u].name).join('", "'),"joinKeys");if(!n)return`"${r(e)}"`;let[s,o]=bt.lodash.partition(e,a=>t[a].isActivated!==!1);return o.length===0?`"${r(s)}"`:s.length===0?`${At(`"${r(o)}"`)}`:`"${r(s)}" ${At(`, "${r(o)}"`)}`},"commentDeactivatedKeys");Rt.exports={getOptions:$t,getPrimaryKeyList:Ct,getTableStatement({tableData:e,tableMetaData:t,dataSources:n,keyspaceMetaData:r,udtTypeMap:s,isKeyspaceActivated:o}){let a=wr(r),u=Kr(t),c=P(t,0,"compositePartitionKey",[]),l=P(t,0,"compositeClusteringKey",[]),m=P(t,0,"schemaId",""),y=P(t,0,"comments",""),g=P(t,0,"tableOptions",""),d=P(t,0,"isActivated",!1),p=o&&d,E=ht(c.map(h=>h.keyId),n),S=ht(l.map(h=>h.keyId),n),f=Wr(a,u,_r(e.properties||{},s,p),Ct(E,S,p),$t(l,S,m,g,y,p),P(t,0,"tableIfNotExist",void 0));return Ur(f,d,o)},mergeValuesWithConfigOptions:vt}});var Z=I((xo,kt)=>{"use strict";var Te=class Te{script;isDropScript;isModifyScript;isAddScript};i(Te,"ModificationScript");var Ne=Te,Ee=class Ee{isActivated;scripts;static getInstances(t,n,r,s){return(t||[]).filter(Boolean).map(o=>this.getInstance([o],n,r,s))}static getInstance(t,n,r,s){var a;if(!((a=t==null?void 0:t.filter(Boolean))!=null&&a.length))return;let o={deletion:!1,add:!1,modify:!1};if(o[r]===void 0)throw new Error(`Unsupported scriptPurpose provided: ${r}`);return o[r]=!0,{isActivated:n,scripts:t.filter(Boolean).map(u=>({isDropScript:o.deletion,script:u,isModifyScript:o.modify,isAddScript:o.add,modelLevel:s}))}}};i(Ee,"AlterScriptDto");var Se=Ee;kt.exports={ModificationScript:Ne,AlterScriptDto:Se}});var Ut=I((ko,jt)=>{"use strict";var{getTypeByData:Pt}=Y(),{getNamesByIds:Ie}=G(),{dependencies:A}=$(),{eachField:Xr,getTableNameStatement:wt}=v(),{getTableStatement:Qr}=Q(),{AlterScriptDto:J}=Z(),k={modifiedColumn:[],addTable:[],deleteTable:[]},Zr=i(e=>ee(e)?[]:[J.getInstance([A.provider.addEntity(e)],!0,"add","field")],"getAdd"),Jr=i(e=>ee(e)?[]:[J.getInstance([A.provider.deleteEntity(e)],!0,"deletion","field")],"getDelete"),Kt=i(e=>{let{tableName:t,keyspaceName:n,columnData:r}=e,s=wt(n,t);return r!=null&&r.name?`${s}.${r==null?void 0:r.name}`:s},"generateFullName"),he=i((e={},t="modifiedColumn")=>{let n=Kt(e);k={...k,[t]:[...(k==null?void 0:k[t])||[],n]}},"addScriptToExistScripts"),ee=i((e={},t="modifiedColumn")=>{let n=Kt(e);return((k==null?void 0:k[t])||[]).some(r=>r===n)},"isScriptExists"),es=i((e,t)=>{let n=i(s=>!s.hasOwnProperty("properties")||!Array.isArray(s.properties)?s:{...s,properties:s.properties.reduce((o,a)=>({...o,[a.name]:n(a)}),{})},"propertiesFromArrayToObj"),r=n(e);return Xr(r,s=>{if((s==null?void 0:s.type)!=="reference"||A.lodash.isEmpty(s.refIdPath))return s;let o=Ie([A.lodash.last(s.refIdPath)],t)[A.lodash.last(s.refIdPath)]||{};return{...s,...o}})},"prepareField"),ts=i(({tableName:e,keyspaceName:t,isOldModel:n,property:r,udtMap:s,dataSources:o})=>{let{oldField:a={},newField:u={}}=(r==null?void 0:r.compMod)||{},c=es(a,o),l=Pt(r,s,u.name),m=Pt(c,s,a.name);return{property:r,isOldModel:n,oldName:a.name,newName:u.name,newType:l,oldType:m,isNameChange:a.name!==u.name,isTypeChange:l!==m,dataForScript:{tableName:e,keyspaceName:t,columnData:{name:u.name,type:l}}}},"hydrateColumn"),Oe=i((e,t)=>{var r,s,o;let n=(s=(r=e==null?void 0:e.role)==null?void 0:r.compMod)==null?void 0:s[t];return(n==null?void 0:n.new)||((o=e==null?void 0:e.role)==null?void 0:o[t])},"getTableParameter"),Dt=i((e,t)=>Object.entries(e).reduce((n,[r,s])=>{let o=(t.find(a=>a.keyId===r)||{}).type;return{...n,[r]:{...A.lodash.omit(s,"type"),...o?{type:o}:{}}}},{}),"addToKeysHashType"),Lt=i((e,t)=>A.lodash.omitBy(e,(n,r)=>n===!1&&!t[r]),"deleteFalseValuesIfNotPresentInOtherColumn"),ns=i((e,t)=>{let n=Lt(e,t),r=Lt(t,e);return A.lodash.isEqual(n,r)},"areTableKeyColumnsEqual"),Ft=i(({newKeys:e=[],oldKeys:t=[],dataSources:n})=>{if(e.length!==t.length)return!1;let r=Dt(Ie(e.map(a=>a.keyId),n),e),s=Dt(Ie(t.map(a=>a.keyId),n),t),o=A.lodash.differenceWith(A.lodash.values(r),A.lodash.values(s),ns);return A.lodash.isEmpty(o)},"tableKeysIsEqual"),rs=i(({item:e,dataSources:t})=>{var c;let n=((c=e==null?void 0:e.role)==null?void 0:c.compMod)||{},r=["name","isActivated"],{compositeClusteringKey:s={},compositePartitionKey:o={}}=n||{},a=Ft({newKeys:s.new,oldKeys:s.old,dataSources:t}),u=Ft({newKeys:o.new,oldKeys:o.old,dataSources:t});return!a||!u||r.some(l=>{var m,y;return!A.lodash.isEqual((m=n[l])==null?void 0:m.new,(y=n[l])==null?void 0:y.old)})},"isTableChange"),ss=i(e=>{if(ee(e,"deleteTable"))return[];let t=wt(e.keyspaceName,e.tableName);return he(e,"deleteTable"),[J.getInstance([A.provider.dropTable(t)],!0,"deletion","table")]},"getDeleteTableDto"),os=i(e=>{if(ee(e,"addTable"))return[];let t=e.item,n=e.data,r=Oe(t,"compositePartitionKey")||[],s=Oe(t,"compositeClusteringKey")||[],o=[{compositePartitionKey:r,compositeClusteringKey:s,collectionName:e.tableName,tableOptions:t.role.tableOptions||"",comments:t.role.comments||"",isActivated:t.role.isActivated}],a=Qr({tableData:t,tableMetaData:o,keyspaceMetaData:[{name:e.keyspaceName}],dataSources:e.dataSources,udtTypeMap:n.udtTypeMap||{},isKeyspaceActivated:e.isKeyspaceActivated});return he(e,"addTable"),[J.getInstance([a],!0,"add","table")]},"getAddTable");jt.exports={getDelete:Jr,getAdd:Zr,hydrateColumn:ts,isTableChange:rs,getTableParameter:Oe,addScriptToExistScripts:he,getDeleteTableDto:ss,getAddTable:os}});var Mt=I((Do,qt)=>{"use strict";var{dependencies:C}=$(),{getColumnDefinition:is}=pe(),{eachField:as}=v(),{getTypeByData:Ae}=Y(),{checkIsOldModel:cs,fieldTypeCompatible:us}=ye(),{getDelete:ds}=Ut(),{AlterScriptDto:_}=Z(),ls={Default_Keyspace:[]},ms={added:!1,deleted:!1,modified:!1,udt:"udt"},ps=i(e=>`ALTER TYPE "${e}"`,"getAlterTypePrefix"),ys=i(e=>[_.getInstance([C.provider.dropType({keyspaceName:e.keyspaceName,typeName:e.typeName})],!0,"deletion","udt")],"getDropUDT"),fs=i(e=>{let{keySpaces:t,udtName:n,name:r,type:s}=e;return Object.keys(t).map(o=>_.getInstance([C.provider.addPropertyToUdt({keySpaceName:o,udtName:n,name:r,type:s})],!0,"add","udt"))},"getAddToUDT"),Ce=i(e=>{var n;let t=(n=e.compMod)==null?void 0:n.bucketsWithCurrentDefinition;return C.lodash.isEmpty(t)?ls:t},"getKeySpaces"),gs=i((e,t)=>{let{role:n={},compMod:r={},properties:s={}}=e,o=Ce(n);if(r.created){let a=is(s,t);return Object.keys(o).map(u=>{let c=n.code||n.name||"";return _.getInstance([C.provider.createUdt({keySpaceName:u,udtName:c,columnScript:a})],!0,"add","udt")})}return Object.entries(s).reduce((a,[u,c])=>[...a,...fs({type:Ae(c,t),name:u,keySpaces:o,udtName:n.code||n.name||""})],[])},"getAddScript"),_t=i((e,t)=>e.type!=="reference"||e.$ref||!t.$ref?e:{...e,$ref:t.$ref},"prepareField"),Ns=i((e,t,n)=>{let{role:r={},properties:s}=e;if(!s)return[];let o=Ce(r),a=r.code||r.name;return Object.entries(s).reduce((u,[c,l])=>{let m=C.lodash.get(l,"compMod.oldField.name"),y=C.lodash.get(l,"compMod.newField.name"),{compMod:g={}}=l,d=Ae(_t(g.oldField,l),n,"newField"),p=Ae(_t(g.newField,l),n,"oldField"),E=cs(C.lodash.get(t,"modelData")),S=Object.keys(o).reduce((f,h)=>{if(p&&d&&p!==d&&us(d,p)&&E){let x=C.provider.updateUdtType({keySpaceName:h,udtName:a,columnData:{name:c,type:p}});f=[...f,_.getInstance([x],!0,"modify","udt")]}if(y&&m&&m!==y){let x=C.provider.renameType({keySpaceName:h,oldFieldName:m,newFieldName:y,udtName:a});f=[...f,_.getInstance([x],!0,"modify","udt")]}return f},[]);return[...u,...S]},[])},"getUpdateScript"),Ss=i(e=>{let{properties:t,compMod:n={},role:r={}}=e;if(!(n!=null&&n.deleted)||!t)return[ms];let s=Ce(r),o=r.code||r.name||"";return Object.entries(s).reduce((a,[u,c])=>{let l=c.reduce((m,y)=>{let g=ds({tableName:y.collectionName||y.code,keyspaceName:u,columnData:{name:o}}),d=ys({keyspaceName:u,typeName:o});return[...m,...g,...d]},[]);return[...a,...l]},[])},"getDeleteScript"),Ts=i(({child:e,mode:t,data:n,udtMap:r})=>t==="add"?gs(e,r):t==="update"?Ns(e,n,r):Ss(e),"getUdtScript"),Es=i(e=>{var u;let t=(u=e.properties.added)==null?void 0:u.items;if(!t||!Array.isArray(t))return e;let n=t.filter(c=>{var m;return(m=c.properties[Object.keys(c.properties)[0]].compMod)==null?void 0:m.created}),r=C.lodash.xorWith(t,n,C.lodash.isEqual);n=n.map(c=>[Object.keys(c.properties)[0],c]);let s=n.map(([c,l])=>c),o=[];n.forEach(([c,l])=>{let m=new Set,y=l.properties[c];as(y||{},d=>{if(d.$ref){let p=d.$ref.split("/").pop();m.add(p)}});let g=Array.from(m).filter(d=>s.includes(d)&&!o.includes(d));if(o.push(...g),!g.length){let d=o.indexOf(c);d===-1?o.unshift(c):o.unshift(...o.splice(d,1))}});let a=s.filter(c=>!o.includes(c));return n=Object.fromEntries(n),n=[...o,...a].map(c=>n[c]).filter(Boolean),e.properties.added.items=[...n,...r],e},"sortAddedUdt");qt.exports={getUdtScript:Ts,sortAddedUdt:Es,getAlterTypePrefix:ps}});var Wt=I((Fo,Bt)=>{"use strict";var{dependencies:D}=$(),Is="caching",Os="compaction",hs="compression",As="id",Cs=[As],q={localReadRepairChance:0,caching:{keys:"ALL",rows_per_partition:"NONE"},compaction:"{'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy', 'max_threshold': '32', 'min_threshold': '4'}",compression:"{'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}",readRepairChance:0,gcGraceSeconds:864e3,bloomFilterFalsePositiveChance:.01,defaultTtl:0,speculativeRetry:"99PERCENTILE",minIndexInterval:128,maxIndexInterval:2048,crcCheckChance:1,memtableFlushPeriod:0},Vt=i((e,t,n)=>{switch(n){case hs:case Os:return $s(e,t);case Is:return bs(e,t);default:return e!==t}},"isDiff"),$s=i((e,t)=>{if(e===""||t==="")return e!==t;let n=JSON.parse(e.replace(/[\'']/g,'"')),r=JSON.parse(t.replace(/[\'']/g,'"'));return!D.lodash.isEqual(n,r)},"isDiffParsedJsonString"),bs=i((e,t)=>{let n=i(o=>{let a=D.lodash.get(o,"rowsPerPartition");return a?{...D.lodash.omit(o,"rowsPerPartition"),rows_per_partition:a}:o},"updateKeys"),r=Object.assign({},n(e),{id:null}),s=Object.assign({},n(t),{id:null});return!D.lodash.isEqual(r,s)},"isDiffCaching"),vs=i((e,t)=>(t=D.lodash.isEmpty(t)?q:t,Object.entries(e).reduce((n,[r,s])=>Cs.includes(r)?n:!t.hasOwnProperty(r)||Vt(t[r],s,r)?Object.assign({},n,{[r]:s}):n,{})),"getModifiedAndNewOptions"),xs=i((e,t)=>(e=D.lodash.isEmpty(e)?q:e,Object.keys(t).filter(n=>!e.hasOwnProperty(n))),"getDeletedOptions"),Rs=i((e,t)=>e.reduce((n,r)=>q.hasOwnProperty(r)&&Vt(D.lodash.get(t,r),q[r],r)?Object.assign({},n,{[r]:q[r]}):n,{}),"getDefaultOptionsByName");Bt.exports={getDiff(e,t){let n=vs(e,t),r=xs(e,t);return Object.assign({},n,Rs(r,t))}}});var Re=I((Ko,Zt)=>{"use strict";var{dependencies:O}=$(),{commentDeactivatedStatement:ve}=K(),{retrieveContainerName:ks,retrieveEntityName:Ps,retrivePropertyFromConfig:M,retrieveIsItemActivated:zt}=v(),{getOptions:Ds,getPrimaryKeyList:Ls}=Q(),Ht=i(e=>e.name,"columnsToName"),Fs=i((e=[],t)=>{let[n,r]=O.lodash.partition(e,o=>O.lodash.get(o,"isActivated",!0));r=r.map(Ht).join(", "),n=n.map(Ht).join(", ");let s=i(o=>ve(o,!1,t,"INLINE"),"getDeactivatedStatement");if(r.length){if(!n.length)return s(r)}else return n;return n+" "+s(", "+r)},"joinColumns"),ws=i((e,t,n={})=>{let r=e[t];return Object.values(n).find(s=>s.GUID===(r==null?void 0:r.definitionId))||{}},"getColumn"),Ks=i((e,t)=>O.lodash.uniqBy(Object.keys(t).map(n=>{let r=O.lodash.get(t,[n,"GUID"]),s=Object.keys(e).find(c=>e[c].definitionId===r),o=e[s],a=`"${O.lodash.get(o,"name",n)}"`,u=O.lodash.get(t[n],"isActivated");return{name:a,isActivated:u}}),"name").filter(O.lodash.identity),"getColumnNames"),js=i((e,t)=>Object.keys(t).reduce((n,r)=>{let s=O.lodash.get(t,[r,"GUID"]),o=Object.keys(e).find(u=>e[u].definitionId===s),a=e[o];return{...n,[O.lodash.get(a,"name",r)]:t[r]}},{}),"getViewColumns"),Gt=i((e=[],t)=>{let[n,r]=O.lodash.partition(e,c=>O.lodash.get(c,"isActivated",!0));if(O.lodash.isEmpty(e)||r.length===e.length)return"";let s=i(c=>`AND ${c} IS NOT NULL`,"generateNewStatement"),o=r.map(c=>s(c.name)).join(" "),a=ve(o,!1,t,"INLINE");return`WHERE ${[...n].reduce((c,l)=>c?`${c} ${s(l.name)}`:`${l.name} IS NOT NULL`,"")}${o?" "+a:""}`},"getWhereStatement"),xe=i((e,t,n={})=>t.reduce((r,s)=>{let o=O.lodash.get(e,[s,"name"]),u=ws(e,s,n).isActivated;return o?Object.assign({},r,{[s]:{name:o,isActivated:u}}):r},{}),"getNamesByIds"),Yt=i((e,t,n)=>{let r=M(t,0,"compositeClusteringKey",[]),s=xe(e,r.map(o=>o.keyId),n);return{clusteringKeys:r,clusteringKeysHash:s}},"getClusteringKeyData"),Xt=i((e,t,n)=>[...$e({collectionRefsDefinitionsMap:e,viewData:t,key:"compositePartitionKey",columns:n}),...$e({collectionRefsDefinitionsMap:e,viewData:t,key:"compositeClusteringKey",columns:n})],"getPrimaryKeys"),$e=i(({collectionRefsDefinitionsMap:e,viewData:t,key:n,columns:r})=>{let s=M(t,0,n,[]),o=xe(e,s.map(a=>a.keyId),r);return O.lodash.values(o).filter(O.lodash.identity).map(a=>({...a,name:`"${a.name}"`}))},"getCompositeKeys"),Qt=i(({collectionRefsDefinitionsMap:e,viewData:t,isParentActivated:n,columns:r})=>{let s=M(t,0,"compositePartitionKey",[]),o=xe(e,s.map(c=>c.keyId),r),a=Yt(e,t,r),u=Ls(o,a.clusteringKeysHash,n);return u?`PRIMARY KEY (${u})`:""},"getPrimaryKeyScript"),Us=i(e=>O.lodash.trim(e||"").replace(/  /g,"    "),"addTab"),be=i(({collectionRefsDefinitionsMap:e,viewData:t,columns:n,isParentActivated:r})=>{let s=Yt(e,t,n),o=M(t,0,"comments",""),a=M(t,0,"tableOptions","");return Us(Ds(s.clusteringKeys,s.clusteringKeysHash,"",a,o,r))},"getOptionsScript"),_s=i(({viewData:e,entitySchema:t,entityData:n,entityName:r,isParentActivated:s,collectionRefsDefinitionsMap:o,columns:a})=>{let u=[],c=(t==null?void 0:t.properties)||{},l=Object.keys(c).reduce((g,d)=>{let p=t.properties[d];return{...g,[p.GUID]:p}},{}),m=Qt({entityFieldsMap:l,entityData:n,isParentActivated:s,columns:a}),y=be({collectionRefsDefinitionsMap:{},viewData:e,columns:a,isParentActivated:s});return u.push(`AS SELECT * FROM ${r}`),u.push(Gt(Xt(o,n,a),s)),m&&u.push(m),y&&u.push(y),u},"getEmptyViewScript");Zt.exports={getOptionsScript:be,getViewScript({schema:e,entitySchema:t,viewData:n,entityData:r,containerData:s,collectionRefsDefinitionsMap:o,isKeyspaceActivated:a=!0,ifNotExist:u=!1}){let c=[],l=js(o,e.properties||{}),m=O.lodash.first(n)||{},y=Ps(r),g=ks(s),d=g?`"${g}"."${y}"`:`"${y}"`,p=m.code||m.name,E=g?`"${g}"."${p}"`:`"${p}"`,S=zt(r)&&zt(n),f=a&&S,h=Qt({collectionRefsDefinitionsMap:o,viewData:n,isParentActivated:f,columns:l}),L=be({collectionRefsDefinitionsMap:o,viewData:n,columns:l,isParentActivated:f});if(c.push(`CREATE MATERIALIZED VIEW ${u?"IF NOT EXISTS ":""}${E}`),O.lodash.isEmpty(l))c=c.concat(_s({viewData:n,entitySchema:t,entityData:r,entityName:d,isParentActivated:f,collectionRefsDefinitionsMap:o,columns:l}));else{let x=Ks(o,l),z=Fs(x,f);c.push(`AS SELECT ${z}`),c.push(`FROM ${d}`),c.push(Gt(O.lodash.uniq([...Xt(o,n,l),...$e({collectionRefsDefinitionsMap:o,viewData:n,key:"whereClause",columns:l})]),f)),h&&c.push(h),L&&c.push(L)}return ve(c.join(`
  `)+";",S,a)}}});var nn=I((Uo,tn)=>{"use strict";var{getViewScript:qs}=Re(),{dependencies:B}=$(),{AlterScriptDto:V}=Z(),Ms=i((e,t)=>`${e?`"${e}".`:""}"${t}"`,"getViewName"),Vs=["code","name"],Bs=i(e=>{let t=Vs.some(o=>{let{new:a,old:u}=e[o]||{};return!B.lodash.isEqual(a,u)}),{tableOptions:n={},comments:r={}}=e;if(r.old&&!r.new)return!1;let s=Object.entries(n.old||{}).some(([o])=>{var a;return!((a=n.new)!=null&&a[o])});return!t&&!s},"getIsOnlyOptionsModify"),Jt=i((e,t)=>{if(!t||!B.lodash.isEqual(e,t))return e;if(!e)return t},"getProperty"),Ws=i((e={},t={})=>{let n=Jt(t.new,t.old),{new:r={},old:s={}}=e,o=Object.entries(r).map(([a,u])=>[a,Jt(u,s[a])]).filter(([a,u])=>u);return{comments:n,tableOptions:Object.fromEntries(o)}},"getDifferentOptions"),en=i(e=>{var o,a;let{compMod:t,properties:n={}}=e.role,r=Object.entries(n).map(([u,c])=>[c.code||c.name||c.displayName||u,c]),s={containerData:[{name:t.keyspaceName}],schema:{properties:Object.fromEntries(r)},viewData:[e.role],ifNotExist:!0,collectionRefsDefinitionsMap:((o=t.collectionData)==null?void 0:o.collectionRefsDefinitionsMap)||{},entityData:((a=t.collectionData)==null?void 0:a.entityData)||[{}]};return qs(s)},"getAddView"),zs=i(e=>{var a,u,c;let t=((a=e.role)==null?void 0:a.compMod)||{};if(!Bs(t)){let l=((u=t.code)==null?void 0:u.old)||((c=t.name)==null?void 0:c.old),m=B.provider.dropView({...e,role:{...e.role,code:l}}),y=en(e);return[V.getInstance([m],!0,"deletion","view"),V.getInstance([y],!0,"add","view")]}let{comments:r,tableOptions:s}=Ws(t.tableOptions,t.comments),o={...e.role,comments:r,tableOptions:s};return[V.getInstance([B.provider.alterView(o)],!0,"modify","view")]},"getModifyView"),Hs=i(({child:e,mode:t})=>t==="add"?[V.getInstance([en(e)],!0,"add","view")]:t==="delete"?[V.getInstance([B.provider.dropView(e)],!0,"deletion","view")]:zs(e),"getViewScript");tn.exports={getViewScript:Hs,getViewName:Ms}});var Xe=I((qo,on)=>{var N=Le(),{tab:b,getTableNameStatement:te,getUserDefinedFunctions:Gs,getUserDefinedAggregations:Ys}=v(),{serializeOptions:Xs}=tt(),{getAlterTypePrefix:ke}=Mt(),{getDiff:Qs}=Wt(),{mergeValuesWithConfigOptions:Zs}=Q(),{parseToString:rn}=ge(),{getViewName:sn}=nn(),{getOptionsScript:Js}=Re(),{wrapInQuotes:T}=ye(),W=i((e,t)=>t?`ALTER TABLE ${T(t)}.${T(e)}`:`ALTER TABLE ${T(e)}`,"alterTablePrefix");on.exports=e=>{let{assignTemplates:t}=e.require("@hackolade/ddl-fe-utils");return{dropTable(n){return t(N.dropTable,{name:n})},createTable(n){if(!n.databaseName)return"";let{ifNotExist:r,databaseName:s,items:o,options:a}=n,u=r?"IF NOT EXISTS ":"";return t(N.createTable,{ifNotExistStatement:u,name:s,items:` (
`+o.map(c=>b(c)).join(`,
`)+`
)`,options:`${a}`})},dropDatabase(n){return n?t(N.dropDatabase,{name:n}):""},createCustomIndex(n){if(!n.tableName)return"";let{name:r,tableName:s,column:o,using:a,options:u,ifNotExist:c}=n,l=c?"IF NOT EXISTS ":"",m=a||"StorageAttachedIndex",y=Object.keys(u).length?`
`+b(`WITH OPTIONS = {
${b(Xs(u).join(`,
`))}
}`):"";return t(N.createCustomIndex,{ifNotExistStatement:l,name:`"${r}"`,tableName:s,column:o,usingStatement:m,optionsStatement:y})},createIndex(n){let{name:r,tableName:s,column:o,ifNotExist:a}=n,u=r?`"${r}"`:"",c=a?"IF NOT EXISTS ":"";return t(N.createIndex,{ifNotExistStatement:c,nameStatement:u,tableName:s,column:o})},createSearchIndex(n){let{ifNotExist:r,tableName:s,columnsStatement:o,profiles:a,config:u,options:c}=n,l=r?"IF NOT EXISTS ":"";return t(N.createSearchIndex,{ifNotExistStatement:l,tableName:s,columnsStatement:o,profiles:a,config:u,options:c})},dropType(n){let{keyspaceName:r,typeName:s}=n;return t(N.dropType,{keyspaceName:T(r),typeName:T(s)})},renameColumn(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(N.renameColumn,{alterTablePrefixStatement:a,oldName:T(o.oldName),newName:T(o.newName)})},addEntity(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(N.addEntity,{alterTablePrefixStatement:a,name:T(o.name),type:o.type})},deleteEntity(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(N.deleteEntity,{alterTablePrefixStatement:a,name:T(o.name)})},addPropertyToUdt(n){let{keySpaceName:r,udtName:s,type:o}=n,a=ke(r);return t(N.addPropertyToUdt,{alterTypePrefixStatement:a,udtName:T(s),name:T(s),type:o})},createUdt(n){let{keySpaceName:r,udtName:s,columnScript:o}=n;return t(N.createUdt,{keySpaceName:T(r),udtName:T(s),columnScript:b(o)})},updateUdtType(n){let{keySpaceName:r,udtName:s,columnData:o}=n,a=ke(r);return t(N.updateUdtType,{alterTypePrefixStatement:a,udtName:T(s),name:T(o.name),type:o.type})},renameType(n){let{keySpaceName:r,udtName:s,oldFieldName:o,newFieldName:a}=n,u=ke(r);return t(N.renameType,{alterTypePrefixStatement:u,udtName:T(s),oldFieldName:T(o),newFieldName:T(a)})},updateType(n){let{tableName:r,keyspaceName:s,columnData:o}=n,a=W(r,s);return t(N.updateType,{alterTablePrefixStatement:a,name:T(o.name),type:o.type})},updateTableOptions(n,r,s){if(!s||!n)return"";let{keyspaceName:o,tableOptions:a={},comments:u}=n,c=i(d=>(d==null?void 0:d.new)&&d.new!==d.old,"isCommentNew"),l=W(r,o),m=Qs(a.new||{},a.old||{}),y=Zs(m),g=c(u)?rn(y,u.new):rn(y);return g?t(N.updateTableOptions,{alterTablePrefixStatement:l,optionsStatement:b(g)}):""},dropSearchIndexConfig(n,r,s){let o=te(n,r);return t(N.dropSearchIndexConfig,{tableNameStatement:o,indexName:s})},modifySearchIndex(n,r,s,o){let a=te(n,r);return t(N.modifySearchIndex,{tableNameStatement:a,key:s,value:o})},dropSearchIndex(n,r){let s=te(n,r);return t(N.dropSearchIndex,{tableNameStatement:s})},dropIndex(n,r){let s=te(n,r);return t(N.dropIndex,{tableNameStatement:s})},dropKeySpace(n){return t(N.dropKeySpace,{keySpaceName:T(n)})},createKeySpace(n,r,s,o,a){let u=Gs(o),c=Ys(a);return t(N.createKeySpace,{keySpaceName:T(n),replication:b(r),durableWrites:b(s),udfScript:u,udaScript:c})},alterKeySpaceReplication(n,r,s){return t(N.alterKeySpaceReplication,{keySpaceName:T(n),replication:b(r),durableWrites:b(s,2)})},dropView(n){let{compMod:r,name:s,code:o}=n.role,a=sn(r.keyspaceName,o||s);return t(N.dropView,{viewName:a})},alterView(n){var u;let r=[n],s=Js({collectionRefsDefinitionsMap:((u=n.compMod.collectionData)==null?void 0:u.collectionRefsDefinitionsMap)||{},viewData:r}),o=n.name||n.code,a=n.compMod.keyspaceName;if(s){let c=sn(a,o);return t(N.alterView,{keySpaceViewName:c,optionScript:b(s)})}return""}}}});module.exports=Xe();
